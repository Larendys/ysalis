const _0x5a5a=['manifestFile','\x20does\x20not\x20exist','title','mergeObject','duplicate','\x20did\x20not\x20provide\x20a\x20valid\x20manifest\x20file.','type','\x20detected\x20in\x20directory\x20','some','\x20is\x20not\x20available\x20for\x20use!\x20\x0a\x20\x20\x20\x20\x20\x20Make\x20sure\x20your\x20core\x20software\x20and\x20game\x20system\x20are\x20fully\x20updated.','styles','write','scripts','paths','reduce','key','1.0.0','availability','Invalid\x20package\x20','Downloading\x20Package','createVerify','signature.json','existsSync','\x20-\x20','\x20declares\x20an\x20invalid\x20language\x20object\x20in\x20its\x20manifest\x20file','\x20declared\x20in\x20','Cleanup','unavailable','summarizeArchive','The\x20downloaded\x20package\x20','PUBLIC_KEY','0.0.0','license','map','UNKNOWN','Cleaning\x20Up\x20Artifacts','installPackage','Each\x20implementation\x20of\x20the\x20AbstractBasePackage\x20must\x20define\x20its\x20packageType','_getStaticFiles','writeFileSync','config','../common/utils','../common/constants','_getPacks','getDirectories','entries','toLowerCase','packs','Package\x20','version','signature','message','.zip','join','exports','push','Invalid\x20signature\x20for\x20protected\x20package\x20','data','info','The\x20','isPathContained','Installation\x20Complete','getManifest','get','parse','getStaticFiles','\x20does\x20not\x20exist\x20to\x20uninstall!','The\x20request\x20to\x20','warn','downloadFile','socketListeners','find','\x20Compendium\x20path\x20','packages','\x20Language\x20definition\x20','getPackages','.json\x20manifest\x20file.','emit','logger','error','_getLanguages','crypto','stringify','The\x20package\x20','dirname','_cleanMetadata','no-referrer','readFileSync','extractArchive','languages','constructor','BASE_SCHEMA','baseDir','Installing','manifest','Required\x20field\x20','name','Error\x20loading\x20package\x20','public','\x20not\x20present\x20in\x20','protected','json','basename','concat','REQUIRES_UPDATE','AVAILABLE','manifest.json','utf-8','compatibleCoreVersion','description','add','esmodules','ver','collection','length','has','rmdir','The\x20requested\x20package\x20','path','_restrictAvailability','absPath','unlinkSync','Installing\x20Package','createPublicKey'];(function(_0x1db1dd,_0x5a5a39){const _0x2c4f87=function(_0x1f8233){while(--_0x1f8233){_0x1db1dd['push'](_0x1db1dd['shift']());}};_0x2c4f87(++_0x5a5a39);}(_0x5a5a,0xe0));const _0x2c4f=function(_0x1db1dd,_0x5a5a39){_0x1db1dd=_0x1db1dd-0x0;let _0x2c4f87=_0x5a5a[_0x1db1dd];return _0x2c4f87;};const crypto=require(_0x2c4f('0x69'));const fs=require('fs');const path=require(_0x2c4f('0x12'));const fetch=require('node-fetch');const util=require(_0x2c4f('0x41'));const {PACKAGE_AVAILABILITY_CODES}=require(_0x2c4f('0x42'));const Files=require('../files/files');const Validators=require('../database/odm/validators');class AbstractBasePackage{constructor(_0x4291c8){this[_0x2c4f('0x51')]=this[_0x2c4f('0x6d')](_0x4291c8);this['id']=this[_0x2c4f('0x51')][_0x2c4f('0x78')];this[_0x2c4f('0x12')]=path[_0x2c4f('0x4d')](this[_0x2c4f('0x72')][_0x2c4f('0x74')],this['id']);this[_0x2c4f('0x24')]=this[_0x2c4f('0x3e')](this[_0x2c4f('0x51')]['scripts']);this[_0x2c4f('0xb')]=this[_0x2c4f('0x3e')](this['data'][_0x2c4f('0xb')]);this['styles']=this[_0x2c4f('0x3e')](this[_0x2c4f('0x51')][_0x2c4f('0x22')]);this[_0x2c4f('0x71')]=this['_getLanguages'](this[_0x2c4f('0x51')][_0x2c4f('0x71')]);this[_0x2c4f('0x47')]=this['_getPacks'](this[_0x2c4f('0x51')][_0x2c4f('0x47')]);}static get[_0x2c4f('0x74')](){return path[_0x2c4f('0x4d')](global[_0x2c4f('0x25')][_0x2c4f('0x51')],this[_0x2c4f('0xd')]);}static get['collection'](){throw new Error(_0x2c4f('0x3d'));}static get[_0x2c4f('0x18')](){return _0x2c4f('0x6');}get['version'](){return this['data'][_0x2c4f('0x49')];}[_0x2c4f('0x6d')](_0x2752ed){const _0x8ac585=this[_0x2c4f('0x72')][_0x2c4f('0x73')];_0x2752ed=util[_0x2c4f('0x1b')](_0x8ac585,_0x2752ed,{'inplace':![]});for(let [_0x461875,_0x3fc369]of Object[_0x2c4f('0x45')](_0x2752ed)){if(_0x461875 in _0x8ac585&&_0x8ac585[_0x461875]instanceof Array&&!(_0x3fc369 instanceof Array)){_0x2752ed[_0x461875]=[];}}_0x2752ed[_0x2c4f('0x9')]=Validators['cleanHTML'](_0x2752ed[_0x2c4f('0x9')]||'');return _0x2752ed;}static[_0x2c4f('0x57')](_0x33d410,{strict=![]}={}){const _0x3620c7=path[_0x2c4f('0x4d')](this[_0x2c4f('0x74')],_0x33d410||'',this[_0x2c4f('0x18')]);if(!fs[_0x2c4f('0x2e')](_0x3620c7)){if(strict){throw new Error(_0x2c4f('0x11')+_0x33d410+'\x20does\x20not\x20exist!');}return null;}let _0x3a5a98=null;try{_0x3a5a98=JSON[_0x2c4f('0x58')](fs[_0x2c4f('0x6f')](_0x3620c7));}catch(_0x2fce5e){if(strict){global[_0x2c4f('0x66')][_0x2c4f('0x67')](_0x2fce5e);throw _0x2fce5e;}else{global[_0x2c4f('0x66')][_0x2c4f('0x5c')](_0x2fce5e);return null;}}this[_0x2c4f('0x13')](_0x3a5a98);if(_0x3a5a98[_0x2c4f('0x33')]&&strict){throw new Error('The\x20requested\x20package\x20'+_0x33d410+_0x2c4f('0x21'));}return new this(_0x3a5a98);}static[_0x2c4f('0x63')](_0xca1231={}){const {files,logger}=config;if(this[_0x2c4f('0x61')])return this[_0x2c4f('0x61')];const _0x4e5be6=files['storages'][_0x2c4f('0x51')];const _0x873a03=_0x4e5be6[_0x2c4f('0x44')](this['baseDir'])[_0x2c4f('0x39')](_0x4dcd51=>path[_0x2c4f('0x4d')](_0x4dcd51,this[_0x2c4f('0x18')]))['filter'](fs[_0x2c4f('0x2e')]);const _0x4c4e58=new Set();return this[_0x2c4f('0x61')]=_0x873a03[_0x2c4f('0x26')]((_0x4047ce,_0x295ae3)=>{let _0x3f61a1;try{_0x3f61a1=JSON[_0x2c4f('0x58')](fs['readFileSync'](_0x295ae3));}catch(_0x982830){_0x982830=new Error(_0x2c4f('0x79')+_0x295ae3+':\x20'+_0x982830[_0x2c4f('0x4b')]);logger[_0x2c4f('0x5c')](_0x982830);return _0x4047ce;}const _0x66ceae=path[_0x2c4f('0x2')](path[_0x2c4f('0x6c')](_0x295ae3));if(_0x3f61a1[_0x2c4f('0x78')]!==_0x66ceae||_0x4c4e58[_0x2c4f('0xf')](_0x3f61a1[_0x2c4f('0x78')])){logger['warn'](_0x2c4f('0x2a')+_0x3f61a1['name']+_0x2c4f('0x1f')+_0x66ceae+'!');return _0x4047ce;}if(_0x3f61a1[_0x2c4f('0x0')]){const _0x1b3fa6=path['join'](path['dirname'](_0x295ae3),_0x2c4f('0x2d'));const _0x94b06b=this['_verifySignature'](_0x1b3fa6,_0x3f61a1['version']);if(!_0x94b06b){logger[_0x2c4f('0x5c')](_0x2c4f('0x50')+_0x3f61a1[_0x2c4f('0x78')]);return _0x4047ce;}}_0x4c4e58[_0x2c4f('0xa')](_0x3f61a1['name']);this[_0x2c4f('0x13')](_0x3f61a1);let _0x382df4=new this(_0x3f61a1);return _0x4047ce[_0x2c4f('0x3')](_0x382df4);},[]);}static['_verifySignature'](_0x26a8c5,_0x52586b){if(!fs['existsSync'](_0x26a8c5))return![];const _0x4ebe81=JSON['parse'](fs[_0x2c4f('0x6f')](_0x26a8c5,_0x2c4f('0x7')));const _0x15c4f9=global[_0x2c4f('0x40')]['license'];const _0x1d4a5c=crypto[_0x2c4f('0x17')](_0x15c4f9[_0x2c4f('0x72')][_0x2c4f('0x36')]);const _0x5ce95c=crypto[_0x2c4f('0x2c')]('SHA256');_0x5ce95c[_0x2c4f('0x23')](JSON[_0x2c4f('0x6a')]({'license':_0x15c4f9[_0x2c4f('0x51')][_0x2c4f('0x38')],'key':_0x4ebe81[_0x2c4f('0x27')],'version':_0x52586b}));const _0x31c08c=_0x5ce95c['verify'](_0x1d4a5c,_0x4ebe81['signature'],'base64');return _0x31c08c;}static[_0x2c4f('0x13')](_0x4151d7){_0x4151d7[_0x2c4f('0x29')]=PACKAGE_AVAILABILITY_CODES[_0x2c4f('0x5')];if(_0x4151d7['compatibleCoreVersion']){const _0x30aaa7=!util['isNewerVersion'](global[_0x2c4f('0xc')],_0x4151d7[_0x2c4f('0x8')]);if(!_0x30aaa7)_0x4151d7[_0x2c4f('0x29')]=PACKAGE_AVAILABILITY_CODES['REQUIRES_UPDATE'];}else{_0x4151d7[_0x2c4f('0x29')]=PACKAGE_AVAILABILITY_CODES[_0x2c4f('0x3a')];}const _0x479fda=_0x4151d7['minimumCoreVersion']||null;if(_0x479fda&&util['isNewerVersion'](_0x479fda,global[_0x2c4f('0xc')])){_0x4151d7[_0x2c4f('0x29')]=PACKAGE_AVAILABILITY_CODES['REQUIRES_CORE'];}_0x4151d7['unavailable']=_0x4151d7[_0x2c4f('0x29')]>PACKAGE_AVAILABILITY_CODES[_0x2c4f('0x4')];}[_0x2c4f('0x3e')](_0x178bd1){if(_0x178bd1===undefined)return[];const _0x5c654a=[{'root':global[_0x2c4f('0x25')][_0x2c4f('0x51')],'dirs':[path['join'](this[_0x2c4f('0x72')][_0x2c4f('0xd')],this['id'])]},{'root':global[_0x2c4f('0x25')][_0x2c4f('0x7a')],'dirs':[_0x2c4f('0x24')]}];return Files[_0x2c4f('0x59')](_0x178bd1,_0x5c654a,{'allowHTTP':!![]});}[_0x2c4f('0x68')](_0x31ecbd){_0x31ecbd=_0x31ecbd?util[_0x2c4f('0x1c')](_0x31ecbd):[];return _0x31ecbd[_0x2c4f('0x26')]((_0x4a272c,_0x5cc48e)=>{if(!_0x5cc48e[_0x2c4f('0x12')]){global[_0x2c4f('0x66')][_0x2c4f('0x67')](_0x2c4f('0x48')+this['id']+_0x2c4f('0x30'));return _0x4a272c;}const _0x3c5ba7=this[_0x2c4f('0x3e')]([_0x5cc48e[_0x2c4f('0x12')]]);if(_0x3c5ba7[_0x2c4f('0xe')]===0x0){logger[_0x2c4f('0x5c')](_0x2c4f('0x53')+this[_0x2c4f('0x51')][_0x2c4f('0x78')]+_0x2c4f('0x62')+(_0x5cc48e[_0x2c4f('0x78')]||_0x5cc48e['lang'])+_0x2c4f('0x19'));return _0x4a272c;}_0x5cc48e['path']=_0x3c5ba7[0x0];_0x4a272c[_0x2c4f('0x4f')](_0x5cc48e);return _0x4a272c;},[]);}[_0x2c4f('0x43')](_0x50d68f){const _0x5eeed3=util[_0x2c4f('0x1c')](_0x50d68f)||[];return _0x5eeed3[_0x2c4f('0x26')]((_0x37efb7,_0x24f0ae)=>{_0x24f0ae['absPath']=path['join'](this['path'],_0x24f0ae['path']);if(!Files[_0x2c4f('0x54')](_0x24f0ae[_0x2c4f('0x14')],this['path'])){logger[_0x2c4f('0x5c')](_0x2c4f('0x53')+this[_0x2c4f('0x51')][_0x2c4f('0x78')]+_0x2c4f('0x60')+_0x24f0ae[_0x2c4f('0x12')]+'\x20is\x20not\x20within\x20the\x20package\x20path\x20'+this[_0x2c4f('0x12')]);return _0x37efb7;}if(!fs['existsSync'](path[_0x2c4f('0x6c')](_0x24f0ae[_0x2c4f('0x14')]))){logger['warn']('The\x20'+this[_0x2c4f('0x51')]['name']+_0x2c4f('0x60')+_0x24f0ae['path']+_0x2c4f('0x19'));return _0x37efb7;}_0x24f0ae['package']=this['id'];_0x37efb7['push'](_0x24f0ae);return _0x37efb7;},[]);}static[_0x2c4f('0x5e')](_0x290eaa){}static async[_0x2c4f('0x56')](_0xa4b8f7){let _0x53d349=null;try{const _0x5cf5d4=await fetch(_0xa4b8f7,{'referrerPolicy':_0x2c4f('0x6e')});_0x53d349=await _0x5cf5d4[_0x2c4f('0x1')]();}catch(_0x497d60){throw new Error(_0x2c4f('0x5b')+_0xa4b8f7+_0x2c4f('0x1d'));}const _0x61d579=[_0x2c4f('0x78'),_0x2c4f('0x1a'),_0x2c4f('0x49')];if(_0x61d579[_0x2c4f('0x20')](_0x5c2ab7=>!_0x53d349[_0x5c2ab7])){throw new Error(_0x2c4f('0x77')+k+_0x2c4f('0x7b')+_0xa4b8f7);}if(_0x53d349[_0x2c4f('0x1e')]&&_0x53d349[_0x2c4f('0x1e')]!==this[_0x2c4f('0x78')][_0x2c4f('0x46')]()){throw new Error('Invalid\x20package\x20type\x20'+_0x53d349[_0x2c4f('0x1e')]+_0x2c4f('0x31')+_0xa4b8f7);}return _0x53d349;}static async['install'](_0x5dfff,_0x445096,_0x110565){const {logger,express}=config;const _0x1804e7=this[_0x2c4f('0x78')][_0x2c4f('0x46')]();const _0x5d0f25=path[_0x2c4f('0x4d')](this[_0x2c4f('0x74')],_0x5dfff);const _0x3792b4=path[_0x2c4f('0x4d')](this[_0x2c4f('0x74')],_0x5dfff+_0x2c4f('0x4c'));let _0x551cf2=0x0;const _0x456866=(_0x3ba407,_0x43b494,_0x58836c)=>{if(_0x43b494===_0x551cf2)return;_0x551cf2=_0x43b494;let _0x81a2ad=_0x58836c+_0x2c4f('0x2f')+_0x43b494+'%';logger[_0x2c4f('0x52')](_0x81a2ad);express['io'][_0x2c4f('0x65')]('progress',{'action':_0x2c4f('0x3c'),'type':_0x1804e7,'name':_0x5dfff,'pct':_0x43b494,'msg':_0x81a2ad,'step':_0x3ba407});};await Files[_0x2c4f('0x5d')](_0x445096,_0x3792b4,{'onProgress':_0x5af976=>_0x456866('Downloading',_0x5af976,_0x2c4f('0x2b'))});let _0x54523f='';let _0x143b5a=await Files['summarizeArchive'](_0x3792b4,{'manifestPath':_0x1804e7+'.json'});if(_0x143b5a[_0x2c4f('0x76')]===null){const _0x1625c7=_0x143b5a['contents'][_0x2c4f('0x5f')](_0x302cd7=>_0x302cd7['endsWith'](_0x1804e7+'.json'));_0x54523f=path[_0x2c4f('0x6c')](_0x1625c7)+'/';_0x143b5a=await Files[_0x2c4f('0x34')](_0x3792b4,{'manifestPath':''+_0x54523f+_0x1804e7+'.json'});}if(!_0x143b5a[_0x2c4f('0x76')]){fs[_0x2c4f('0x15')](_0x3792b4);throw new Error(_0x2c4f('0x35')+_0x5dfff+'\x20did\x20not\x20contain\x20the\x20expected\x20'+_0x1804e7+_0x2c4f('0x64'));}const _0x569165=JSON[_0x2c4f('0x58')](_0x143b5a['manifest']);await Files['rmdir'](_0x5d0f25);await Files[_0x2c4f('0x70')](_0x3792b4,_0x5d0f25,{'onProgress':(_0x28f6b0,_0x502304,_0x188005,_0x5e21e6)=>_0x456866(_0x2c4f('0x75'),_0x5e21e6,_0x2c4f('0x16')),'removeRoot':_0x54523f});if(_0x110565){const _0x362533=path[_0x2c4f('0x4d')](_0x5d0f25,_0x2c4f('0x2d'));fs[_0x2c4f('0x3f')](_0x362533,JSON[_0x2c4f('0x6a')]({'key':_0x110565['key'],'signature':_0x110565[_0x2c4f('0x4a')]},null,0x2));}_0x456866(_0x2c4f('0x32'),0x64,_0x2c4f('0x3b'));fs[_0x2c4f('0x15')](_0x3792b4);_0x456866('Complete',0x64,_0x2c4f('0x55'));this[_0x2c4f('0x61')]=null;return _0x569165;}static async['uninstall'](_0x3c5a3a){const _0x21b491=this['get'](_0x3c5a3a);if(!_0x21b491)throw new Error(_0x2c4f('0x6b')+_0x3c5a3a+_0x2c4f('0x5a'));await Files[_0x2c4f('0x10')](_0x21b491[_0x2c4f('0x12')]);this['packages']=null;return _0x21b491[_0x2c4f('0x51')];}static['resetPackages'](){this[_0x2c4f('0x61')]=null;}}AbstractBasePackage[_0x2c4f('0x61')]=null;AbstractBasePackage[_0x2c4f('0x73')]={'name':'','title':'','description':'','version':_0x2c4f('0x28'),'minimumCoreVersion':_0x2c4f('0x37'),'compatibleCoreVersion':'1.0.0','scripts':[],'esmodules':[],'styles':[],'packs':[],'languages':[],'authors':[],'keywords':[],'socket':![],'url':'','manifest':'','download':'','license':'','readme':'','bugs':'','changelog':''};module[_0x2c4f('0x4e')]={'AbstractBasePackage':AbstractBasePackage};
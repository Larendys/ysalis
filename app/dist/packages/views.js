const _0x1595=['error','isDowngrade','./world','A\x20manifest\x20URL\x20must\x20be\x20provided','json','isUpgrade','version','status','stringify','\x20or\x20greater','\x20and\x20may\x20not\x20downgrade\x20to\x20an\x20older\x20version','The\x20','license','minimumCoreVersion','resetPackages','\x20does\x20not\x20specify\x20a\x20compatibleCoreVersion\x20and\x20may\x20not\x20work\x20with\x20Foundry\x20VTT\x20version\x20','Invalid\x20package\x20type\x20','\x20has\x20no\x20manifest\x20URL\x20provided','Reset\x20package\x20cache\x20for\x20all\x20package\x20types','LICENSE_API_KEY','title','compatibleCoreVersion','\x20requires\x20a\x20more\x20modern\x20Foundry\x20VTT\x20core\x20version\x20of\x20','https://foundryvtt.com/_api/packages/get','exports','POST','\x20does\x20not\x20provide\x20a\x20download\x20URL\x20that\x20can\x20be\x20installed','application/json','https://foundryvtt.com/_api/packages/auth','./system','ver','getManifest','isSupported','\x20requested','./module','../auth','\x20may\x20not\x20be\x20compatible\x20with\x20Foundry\x20VTT\x20versions\x20newer\x20than\x20','data','APIKey:','node-fetch','\x20version\x20','install','compatibility','warning','download','manifest'];(function(_0x26f312,_0x159566){const _0x1c5575=function(_0x3c11d7){while(--_0x3c11d7){_0x26f312['push'](_0x26f312['shift']());}};_0x1c5575(++_0x159566);}(_0x1595,0x107));const _0x1c55=function(_0x26f312,_0x159566){_0x26f312=_0x26f312-0x0;let _0x1c5575=_0x1595[_0x26f312];return _0x1c5575;};const fetch=require(_0x1c55('0x6'));const {License}=require(_0x1c55('0x2'));const {Module}=require(_0x1c55('0x1'));const {System}=require(_0x1c55('0x2a'));const {World}=require(_0x1c55('0xf'));const util=require('../common/utils');const PACKAGE_TYPE_MAPPING={'module':Module,'system':System,'world':World};const PACKAGE_SEARCH_URL=_0x1c55('0x24');const PACKAGE_DOWNLOAD_URL=_0x1c55('0x29');async function getPackages({type='system'}={}){const _0x2ea358=await fetch(PACKAGE_SEARCH_URL,{'headers':{'Content-Type':_0x1c55('0x28'),'Authorization':_0x1c55('0x5')+License[_0x1c55('0x20')]},'method':_0x1c55('0x26'),'body':JSON[_0x1c55('0x15')]({'type':type,'version':config['ver'],'license':config[_0x1c55('0x19')][_0x1c55('0x4')]})});const _0x63608c=await _0x2ea358[_0x1c55('0x11')]();return _0x63608c;}async function getProtectedDownloadURL({type,name,version}={}){const _0x5e7137=await fetch(PACKAGE_DOWNLOAD_URL,{'headers':{'Content-Type':_0x1c55('0x28'),'Authorization':_0x1c55('0x5')+License['LICENSE_API_KEY']},'method':_0x1c55('0x26'),'body':JSON[_0x1c55('0x15')]({'type':type,'name':name,'version':version,'license':config[_0x1c55('0x19')][_0x1c55('0x4')]})});const _0x319fc3=await _0x5e7137[_0x1c55('0x11')]();return _0x319fc3;}async function checkPackage({type,name,manifest}={}){const _0x15bf70=PACKAGE_TYPE_MAPPING[type];if(!_0x15bf70)throw new Error(_0x1c55('0x1d')+type+_0x1c55('0x0'));let _0x3b464b=null;if(!manifest){_0x3b464b=_0x15bf70['get'](name,{'strict':![]});if(!_0x3b464b[_0x1c55('0x4')]['manifest']){throw new Error(_0x1c55('0x18')+type+'\x20'+name+_0x1c55('0x1e'));}manifest=_0x3b464b[_0x1c55('0x4')][_0x1c55('0xc')];}const _0x2b8571=await _0x15bf70[_0x1c55('0x2c')](manifest);const _0x3a9e11=global[_0x1c55('0x2b')];_0x2b8571[_0x1c55('0x12')]=_0x3b464b?util['isNewerVersion'](_0x2b8571[_0x1c55('0x13')],_0x3b464b[_0x1c55('0x4')][_0x1c55('0x13')]):!![];_0x2b8571[_0x1c55('0xe')]=_0x3b464b?util['isNewerVersion'](_0x3b464b[_0x1c55('0x4')][_0x1c55('0x13')],_0x2b8571[_0x1c55('0x13')]):![];_0x2b8571[_0x1c55('0x2d')]=!util['isNewerVersion'](_0x2b8571[_0x1c55('0x1a')],_0x3a9e11);_0x2b8571['compatibility']=null;if(_0x2b8571[_0x1c55('0x22')]){_0x2b8571[_0x1c55('0x9')]=!util['isNewerVersion'](_0x3a9e11,_0x2b8571[_0x1c55('0x22')]);}return _0x2b8571;}async function installPackage({type,name,manifest}){const _0x3a33d8=PACKAGE_TYPE_MAPPING[type];if(!_0x3a33d8)throw new Error(_0x1c55('0x1d')+type+_0x1c55('0x0'));if(!manifest)throw new Error(_0x1c55('0x10'));let _0x5136f7=await checkPackage({'type':type,'name':name,'manifest':manifest});if(_0x5136f7[_0x1c55('0xe')]){throw new Error('You\x20are\x20currently\x20using\x20a\x20more\x20recent\x20version\x20of\x20'+type+'\x20'+_0x5136f7[_0x1c55('0x21')]+_0x1c55('0x17'));}if(!_0x5136f7[_0x1c55('0x2d')]){throw new Error(_0x5136f7[_0x1c55('0x21')]+'\x20'+type+_0x1c55('0x7')+_0x5136f7['version']+_0x1c55('0x23')+_0x5136f7[_0x1c55('0x1a')]+_0x1c55('0x16'));}name=_0x5136f7['name'];let _0x4e242c=_0x5136f7['download'];const _0x403b70=_0x5136f7['protected']?await getProtectedDownloadURL({'type':type,'name':name,'version':_0x5136f7[_0x1c55('0x13')]}):null;if(_0x403b70){if(_0x403b70[_0x1c55('0x14')]===_0x1c55('0xd'))throw new Error(_0x403b70['message']);_0x4e242c=_0x403b70[_0x1c55('0xb')];}if(!_0x4e242c){throw new Error(_0x1c55('0x18')+_0x5136f7[_0x1c55('0x21')]+'\x20'+type+_0x1c55('0x27'));}const _0xe33bd6=await _0x3a33d8[_0x1c55('0x8')](name,_0x4e242c,_0x403b70);_0xe33bd6['installed']=!![];if(_0x5136f7[_0x1c55('0x9')]===![]){_0xe33bd6[_0x1c55('0xa')]=_0x5136f7[_0x1c55('0x21')]+_0x1c55('0x7')+_0x5136f7['version']+_0x1c55('0x3')+_0x5136f7['compatibleCoreVersion'];}else if(_0x5136f7[_0x1c55('0x9')]===null){_0xe33bd6['warning']=_0x5136f7[_0x1c55('0x21')]+_0x1c55('0x7')+_0x5136f7[_0x1c55('0x13')]+_0x1c55('0x1c')+config[_0x1c55('0x2b')];}return _0xe33bd6;}async function resetPackages(){Module[_0x1c55('0x1b')]();System[_0x1c55('0x1b')]();World['resetPackages']();return{'message':_0x1c55('0x1f')};}async function uninstallPackage({type,name}){const _0x36b226=PACKAGE_TYPE_MAPPING[type];if(!_0x36b226)throw new Error(_0x1c55('0x1d')+type+_0x1c55('0x0'));const _0x4fdd41=_0x36b226['uninstall'](name);_0x4fdd41['uninstalled']=!![];return _0x4fdd41;}module[_0x1c55('0x25')]={'checkPackage':checkPackage,'getPackages':getPackages,'installPackage':installPackage,'resetPackages':resetPackages,'uninstallPackage':uninstallPackage};
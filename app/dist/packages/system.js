const _0x139d=['template','Entity','documents','error','_processSystemTemplate','parse','customDataModel','manifestFile','system','existsSync','reduce','filter','templates','system.json','mergeObject','readFileSync','./package','concat','../common/utils','length','metadata','exports','user','types','emit','Unable\x20to\x20parse\x20system\x20template\x20for\x20','name','_getDataModel','_id','duplicate','from','prototype','_getEntityTypes','hasProperty','model','entityTypes','data','path'];(function(_0xf10892,_0x139d2d){const _0x501fdc=function(_0x40762f){while(--_0x40762f){_0xf10892['push'](_0xf10892['shift']());}};_0x501fdc(++_0x139d2d);}(_0x139d,0xa3));const _0x501f=function(_0xf10892,_0x139d2d){_0xf10892=_0xf10892-0x0;let _0x501fdc=_0x139d[_0xf10892];return _0x501fdc;};const fs=require('fs');const path=require(_0x501f('0x1a'));const util=require(_0x501f('0x7'));const {AbstractBasePackage}=require(_0x501f('0x5'));const {BASE_ENTITY_TYPE}=require('../common/constants');class System extends AbstractBasePackage{constructor(..._0xdc2094){super(..._0xdc2094);const _0x479560=this['_processSystemTemplate']();this[_0x501f('0x1b')]=_0x479560[_0x501f('0x1b')];this[_0x501f('0x18')]=_0x479560[_0x501f('0xc')];this[_0x501f('0x17')]=_0x479560['model'];}[_0x501f('0x1f')](){const _0x2eeb3d=path['join'](this['path'],'template.json');let _0x57e632={};if(fs[_0x501f('0x24')](_0x2eeb3d)){try{_0x57e632=JSON[_0x501f('0x20')](fs[_0x501f('0x4')](_0x2eeb3d));}catch(_0xf9e53f){logger[_0x501f('0x1e')](_0x501f('0xe')+this['data'][_0x501f('0xf')]+':\x20'+_0xf9e53f);}}const _0x566f3d=this[_0x501f('0x15')](_0x57e632);const _0x293f2c=this[_0x501f('0x10')](_0x57e632,_0x566f3d);return{'template':_0x57e632,'types':_0x566f3d,'model':_0x293f2c};}[_0x501f('0x15')](_0x5f4672){const _0x5449ff=db[_0x501f('0x1d')][_0x501f('0x0')](_0xde8be2=>_0xde8be2[_0x501f('0x14')]instanceof db['Entity']);return _0x5449ff[_0x501f('0x25')]((_0x24e485,_0x44a0da)=>{let _0x455fdc=_0x44a0da['metadata'][_0x501f('0x18')];const _0x1b2d26=util[_0x501f('0x16')](_0x5f4672,_0x44a0da[_0x501f('0xf')]+'.types')?_0x5f4672[_0x44a0da['name']][_0x501f('0xc')]:[];const _0x35fa83=Array[_0x501f('0x13')](new Set(_0x455fdc[_0x501f('0x6')](_0x1b2d26)));_0x24e485[_0x44a0da['name']]=_0x35fa83[_0x501f('0x8')]?_0x35fa83:[BASE_ENTITY_TYPE];return _0x24e485;},{});}[_0x501f('0x10')](_0x1fa951,_0x157c4a){const _0x41553e=db['documents'][_0x501f('0x0')](_0x599417=>_0x599417[_0x501f('0x14')]instanceof db[_0x501f('0x1c')]&&_0x599417[_0x501f('0x9')][_0x501f('0x21')]);return _0x41553e[_0x501f('0x25')]((_0x4c99be,_0x9fec60)=>{const _0xdf1b8e=_0x1fa951['hasOwnProperty'](_0x9fec60[_0x501f('0xf')])?_0x1fa951[_0x9fec60['name']]:{};const _0x22a5c7=!util['isObjectEmpty'](_0xdf1b8e);_0x4c99be[_0x9fec60[_0x501f('0xf')]]=_0x157c4a[_0x9fec60[_0x501f('0xf')]][_0x501f('0x25')]((_0xd9c4f8,_0x3872c1)=>{const _0x39dc1d=_0x22a5c7?util[_0x501f('0x12')](_0xdf1b8e[_0x3872c1]||{}):{};let _0x1baa17={};let _0x21c10b=_0x39dc1d[_0x501f('0x1')]||[];_0x21c10b=_0x21c10b[_0x501f('0x0')](_0xbac72f=>util[_0x501f('0x16')](_0xdf1b8e,'templates.'+_0xbac72f));for(let _0x17c7d1 of _0x21c10b){util['mergeObject'](_0x1baa17,_0xdf1b8e['templates'][_0x17c7d1],{'enforceTypes':![]});}delete _0x39dc1d['templates'];_0x1baa17=util[_0x501f('0x3')](_0x1baa17,_0x39dc1d,{'inplace':![],'enforceTypes':![]});_0xd9c4f8[_0x3872c1]=_0x1baa17;return _0xd9c4f8;},{});return _0x4c99be;},{});}static get['collection'](){return'systems';}static get[_0x501f('0x22')](){return _0x501f('0x2');}static['socketListeners'](_0x39878f){super['socketListeners'](_0x39878f);const _0x40f5ed=game['world'][_0x501f('0x23')];if(_0x40f5ed&&_0x40f5ed[_0x501f('0x19')]['socket']){const _0x4021c1='system.'+_0x40f5ed[_0x501f('0x19')][_0x501f('0xf')];_0x39878f['on'](_0x4021c1,(_0x520384,_0x3e71ed)=>{if(_0x3e71ed instanceof Function)_0x3e71ed();_0x39878f['broadcast'][_0x501f('0xd')](_0x4021c1,_0x520384,_0x39878f[_0x501f('0xb')][_0x501f('0x11')]);});}}}module[_0x501f('0xa')]={'System':System};
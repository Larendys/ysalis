const _0x47f0=['Update\x20completed\x20successfully.\x20Restarting\x20Foundry\x20VTT\x20application.','No\x20core\x20software\x20update\x20is\x20currently\x20available.','data','_throttlePct','Update\x20Download\x20Failed:\x20','Extracting\x20Update','You\x20do\x20not\x20have\x20permission\x20to\x20write\x20files\x20in\x20your\x20Foundry\x20Virtual\x20Tabletop\x20installation\x20\x0a\x20\x20\x20\x20\x20\x20location.\x20You\x20may\x20need\x20to\x20run\x20the\x20application\x20as\x20an\x20Administrator\x20to\x20perform\x20an\x20update.','POST','./common/utils','catch','dist','target','isElectron','LICENSE_API_KEY','noupdate','options','updateCore','APIKey:','templates','SOFTWARE_UPDATE_CHANNELS','progress','accessSync','check','stringify','root','Extraction\x20Complete','Installation\x20Complete','race','argv','extractArchive','license','\x20update\x20','\x20-\x20','Core\x20software\x20','You\x20are\x20already\x20using\x20the\x20latest\x20update\x20available\x20on\x20the\x20','then','SHUTDOWN','min','json','_getManifest','Update\x20completed\x20successfully.\x20Shutting\x20down\x20Foundry\x20Virtual\x20Tabletop\x20server\x20for\x20manual\x20restart.','appDir','No\x20update\x20archive\x20exists\x20to\x20install','default','download','\x20is\x20not\x20a\x20valid\x20software\x20update\x20channel\x20to\x20check.','exports','message','\x20channel.','Downloading\x20Update','now','./files/files','updateChannel','\x20is\x20now\x20available!','You\x20are\x20not\x20allowed\x20to\x20update\x20this\x20instance\x20of\x20Foundry\x20Virtual\x20Tabletop\x20because\x20it\x20was\x20launched\x20in\x20--noupdate\x20mode.','No\x20update\x20is\x20available\x20on\x20the\x20requested\x20','willDisableModules','Extracting\x20update\x20files','releaseTime','Core\x20software\x20update\x20check\x20failed:\x20','constants','true','_update','join','_getPlatform','win32','round','slice','version','release_time','unlinkSync','defineProperty','parse','getUpdateNotification','_getDownload','__esModule','error','application/json','downloadFile','ver','Downloading\x20software\x20update','Download\x20Complete','warn','spawn','map','all','localDest','path','RESTART','status','No\x20target\x20version\x20has\x20yet\x20been\x20identified!','existsSync','_updateCheckTime','Software\x20update\x20complete!','channel','updateDir','core','__importDefault','darwin','url','emit','./const','file','platform','node-fetch','W_OK','update','split','rmdir','./auth','FoundryVTT','copyDirectorySync','exit','info','install'];(function(_0x53d9de,_0x47f0c0){const _0x6ddbca=function(_0x2f0372){while(--_0x2f0372){_0x53d9de['push'](_0x53d9de['shift']());}};_0x6ddbca(++_0x47f0c0);}(_0x47f0,0x1c4));const _0x6ddb=function(_0x53d9de,_0x47f0c0){_0x53d9de=_0x53d9de-0x0;let _0x6ddbca=_0x47f0[_0x53d9de];return _0x6ddbca;};'use strict';var __importDefault=this&&this[_0x6ddb('0x69')]||function(_0x248879){return _0x248879&&_0x248879[_0x6ddb('0x53')]?_0x248879:{'default':_0x248879};};Object[_0x6ddb('0x4f')](exports,_0x6ddb('0x53'),{'value':!![]});const fetch=require(_0x6ddb('0x70'));const {isNewerVersion}=require(_0x6ddb('0x10'));const {License,updateUserOptions}=require(_0x6ddb('0x2'));const fs_1=__importDefault(require('fs'));const os_1=__importDefault(require('os'));const path_1=__importDefault(require(_0x6ddb('0x5f')));const url_1=__importDefault(require(_0x6ddb('0x6b')));const child_process_1=require('child_process');const files_1=__importDefault(require(_0x6ddb('0x3b')));const const_1=require(_0x6ddb('0x6d'));class Updater{constructor(_0x5e1330){this[_0x6ddb('0x31')]=_0x5e1330[_0x6ddb('0x20')];this[_0x6ddb('0x67')]=path_1[_0x6ddb('0x33')]['join'](_0x5e1330[_0x6ddb('0x20')],_0x6ddb('0x46'));this[_0x6ddb('0x6f')]=this[_0x6ddb('0x48')]();this['target']=null;this['_throttlePct']=null;this[_0x6ddb('0x64')]=0x0;}['_getPlatform'](){let _0x3a0885=os_1[_0x6ddb('0x33')]['platform']();if(_0x3a0885===_0x6ddb('0x49'))return'win';else if(_0x3a0885===_0x6ddb('0x6a'))return'mac';return'linux';}get['file'](){if(!this[_0x6ddb('0x13')])throw new Error(_0x6ddb('0x62'));const _0x560d13=url_1[_0x6ddb('0x33')][_0x6ddb('0x50')](config['updater'][_0x6ddb('0x13')][_0x6ddb('0x34')])['pathname'];return _0x560d13?path_1[_0x6ddb('0x33')]['parse'](_0x560d13)['base']:null;}get['localDest'](){return this['updateDir']+'/'+this[_0x6ddb('0x6e')];}async['check']({updateChannel='release',forceUpdate}={}){let _0x465cf9=null;forceUpdate=[_0x6ddb('0x45'),!![]]['includes'](forceUpdate);if(!(updateChannel in const_1[_0x6ddb('0x1b')])){throw new Error(updateChannel+_0x6ddb('0x35'));}if(config[_0x6ddb('0x17')][_0x6ddb('0x16')]){throw new Error(_0x6ddb('0x3e'));}if(updateChannel!==config[_0x6ddb('0x17')][_0x6ddb('0x3c')]){updateUserOptions({'updateChannel':updateChannel});}try{_0x465cf9=await this['_getManifest'](updateChannel);}catch(_0x591960){throw new Error(_0x6ddb('0x3f')+updateChannel+_0x6ddb('0x38'));}if(_0x465cf9[_0x6ddb('0x61')]==='error'){throw new Error(_0x465cf9['message']);}const _0x4a2e46=forceUpdate?!![]:isNewerVersion(_0x465cf9[_0x6ddb('0x4c')],config[_0x6ddb('0x57')]);if(!_0x4a2e46){throw new Error(_0x6ddb('0x2a')+updateChannel+_0x6ddb('0x38'));}const _0xba1e59=config[_0x6ddb('0x57')][_0x6ddb('0x0')]('.')[_0x6ddb('0x4b')](0x0,0x2)[_0x6ddb('0x47')]('.');const _0x2f35c9=_0x465cf9[_0x6ddb('0x4c')][_0x6ddb('0x0')]('.')['slice'](0x0,0x2)[_0x6ddb('0x47')]('.');const _0x18f3de=isNewerVersion(_0x2f35c9,_0xba1e59);_0x465cf9[_0x6ddb('0x40')]=_0x18f3de;return this[_0x6ddb('0x13')]=_0x465cf9;}async[_0x6ddb('0x2f')](_0x35e89c){const _0x4b8e3f=await fetch(License['SOFTWARE_UPDATE_URL'],{'headers':{'Content-Type':_0x6ddb('0x55'),'Authorization':_0x6ddb('0x19')+License[_0x6ddb('0x15')]},'method':_0x6ddb('0xf'),'body':JSON['stringify']({'updateChannel':_0x35e89c,'license':config[_0x6ddb('0x26')][_0x6ddb('0xa')]})});return _0x4b8e3f[_0x6ddb('0x2e')]();}async[_0x6ddb('0x72')](){if(config[_0x6ddb('0x17')][_0x6ddb('0x16')]){throw new Error(_0x6ddb('0x3e'));}await this[_0x6ddb('0x34')]();await this[_0x6ddb('0x7')]();return this['restart']();}async[_0x6ddb('0x34')](){if(!this['target']){throw new Error('No\x20update\x20target\x20has\x20been\x20identified');}const _0x5c09ec=await this[_0x6ddb('0x52')](this[_0x6ddb('0x13')][_0x6ddb('0x4c')]);const _0x31b5eb=_0x5c09ec[_0x6ddb('0x34')];try{fs_1['default'][_0x6ddb('0x1d')](paths[_0x6ddb('0x20')],fs_1[_0x6ddb('0x33')][_0x6ddb('0x44')][_0x6ddb('0x71')]);await files_1['default'][_0x6ddb('0x1')](this['updateDir']);await files_1[_0x6ddb('0x33')]['mkdir'](this[_0x6ddb('0x67')]);}catch(_0x2e0f58){console[_0x6ddb('0x54')](_0x2e0f58);throw new Error(_0x6ddb('0xe'));}await files_1[_0x6ddb('0x33')][_0x6ddb('0x56')](_0x31b5eb,this['localDest'],{'onProgress':_0x559ec5=>{this[_0x6ddb('0x1c')]({'step':_0x6ddb('0x39'),'message':_0x6ddb('0x58'),'pct':_0x559ec5});}})[_0x6ddb('0x2b')](()=>{this['progress']({'step':_0x6ddb('0x59'),'message':_0x6ddb('0x58'),'pct':0x64});})[_0x6ddb('0x11')](_0x232e44=>{throw new Error(_0x6ddb('0xc')+_0x232e44[_0x6ddb('0x37')]);});return this[_0x6ddb('0x5e')];}async[_0x6ddb('0x52')](_0x26a659){const _0x5775d7=await fetch(License['SOFTWARE_DOWNLOAD_URL'],{'headers':{'Content-Type':'application/json','Authorization':_0x6ddb('0x19')+License[_0x6ddb('0x15')]},'method':_0x6ddb('0xf'),'body':JSON[_0x6ddb('0x1f')]({'version':_0x26a659,'license':config['license'][_0x6ddb('0xa')]})});return _0x5775d7[_0x6ddb('0x2e')]();}async['install'](){if(!fs_1[_0x6ddb('0x33')][_0x6ddb('0x63')](this[_0x6ddb('0x5e')])){throw new Error(_0x6ddb('0x32'));}this[_0x6ddb('0xb')]=null;const _0x18dcc0=await files_1[_0x6ddb('0x33')][_0x6ddb('0x25')](this['localDest'],this[_0x6ddb('0x67')],{'onProgress':(_0x196514,_0x49146b,_0x549dd0,_0x27cf24)=>{if(_0x27cf24!==this['_throttlePct']){this[_0x6ddb('0x1c')]({'step':_0x6ddb('0xd'),'message':_0x6ddb('0x41'),'pct':_0x27cf24});this['_throttlePct']=_0x27cf24;}}});this['progress']({'step':_0x6ddb('0x21'),'message':'Extracting\x20downloaded\x20update','pct':0x64});fs_1[_0x6ddb('0x33')][_0x6ddb('0x4e')](this[_0x6ddb('0x5e')]);const _0xb21b3=[_0x6ddb('0x12'),'public',_0x6ddb('0x1a')];const _0x501ba5=_0xb21b3[_0x6ddb('0x5c')](_0x353e4a=>files_1[_0x6ddb('0x33')][_0x6ddb('0x1')](_0x353e4a));await Promise[_0x6ddb('0x5d')](_0x501ba5);let _0x287ea5=0x0;this[_0x6ddb('0xb')]=null;const _0x558e94=0x4;await files_1[_0x6ddb('0x33')][_0x6ddb('0x4')](this[_0x6ddb('0x67')],this[_0x6ddb('0x31')],{'onProgress':(_0x55b488,_0x2a9373)=>{_0x287ea5++;let _0x5c467e=Math[_0x6ddb('0x2d')](Math[_0x6ddb('0x4a')](_0x287ea5*0x64*_0x558e94/_0x18dcc0),0x64);if(_0x5c467e!==this['_throttlePct']){this['progress']({'step':'Installing\x20Update','message':'Installing\x20update\x20files','pct':_0x5c467e});this[_0x6ddb('0xb')]=_0x5c467e;}}});this[_0x6ddb('0x1c')]({'step':_0x6ddb('0x22'),'message':_0x6ddb('0x65'),'pct':0x64});await files_1[_0x6ddb('0x33')][_0x6ddb('0x1')](this['updateDir']);}async['restart'](_0x23cfce={}){const {options}=config;if(!options[_0x6ddb('0x14')]){setTimeout(process[_0x6ddb('0x5')],0x32);return{'message':_0x6ddb('0x30'),'type':_0x6ddb('0x2c')};}let _0x3ae47a=process[_0x6ddb('0x24')][0x0];let _0x26538e=process['argv'][_0x6ddb('0x4b')](0x1)||[];_0x23cfce['restart']=0x1;setTimeout(()=>{child_process_1[_0x6ddb('0x5b')](_0x3ae47a,_0x26538e,{'detached':!![],'cwd':this[_0x6ddb('0x31')],'stdio':'inherit','env':_0x23cfce})['unref']();process['exit']();},0x32);return{'message':_0x6ddb('0x8'),'next':_0x6ddb('0x60')};}[_0x6ddb('0x1c')]({step,message,pct=0x0}={}){const {logger,express}=config;logger['info'](pct?message+_0x6ddb('0x28')+pct+'%':message);express['io'][_0x6ddb('0x6c')](_0x6ddb('0x1c'),{'action':_0x6ddb('0x18'),'type':_0x6ddb('0x68'),'name':_0x6ddb('0x3'),'pct':pct,'step':step,'msg':message});}async[_0x6ddb('0x51')](){if(config['options'][_0x6ddb('0x16')])return null;const _0x480f95=Date[_0x6ddb('0x3a')]();if(_0x480f95-this[_0x6ddb('0x64')]<0x3e8*0x3c*0x3c*0x18){if(!this[_0x6ddb('0x13')])return null;return{'version':this[_0x6ddb('0x13')][_0x6ddb('0x4c')],'channel':this[_0x6ddb('0x13')]['channel'],'releaseTime':this[_0x6ddb('0x13')][_0x6ddb('0x42')]};}this[_0x6ddb('0x64')]=_0x480f95;let _0x13236c=null;let _0x26bdc2=![];try{const _0x4a0cd6=this[_0x6ddb('0x1e')]({'updateChannel':config['options']['updateChannel']})[_0x6ddb('0x2b')](_0x170e7b=>{logger[_0x6ddb('0x6')](_0x6ddb('0x29')+_0x170e7b[_0x6ddb('0x66')]+_0x6ddb('0x27')+_0x170e7b[_0x6ddb('0x4c')]+_0x6ddb('0x3d'));_0x13236c={'version':_0x170e7b[_0x6ddb('0x4c')],'channel':_0x170e7b[_0x6ddb('0x66')],'releaseTime':_0x170e7b[_0x6ddb('0x4d')]};_0x26bdc2=!![];})['catch'](_0x2bdbd3=>{_0x26bdc2=!![];logger[_0x6ddb('0x6')](_0x6ddb('0x9'));});const _0x546e25=new Promise(_0x19adf9=>setTimeout(()=>{if(!_0x26bdc2){logger[_0x6ddb('0x5a')]('The\x20Foundry\x20Virtual\x20Tabletop\x20website\x20could\x20not\x20be\x20reached\x20to\x20check\x20for\x20core\x20software\x20updates.');}_0x19adf9();},0xbb8));await Promise[_0x6ddb('0x23')]([_0x4a0cd6,_0x546e25]);}catch(_0x382ba2){logger[_0x6ddb('0x54')](_0x6ddb('0x43')+_0x382ba2[_0x6ddb('0x37')]);}return _0x13236c;}}module[_0x6ddb('0x36')]=Updater;
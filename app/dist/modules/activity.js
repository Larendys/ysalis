const _0x3632=['info','../common/utils','ready','socketListeners','user','core.time','get','length','pause','_id','logger','now','find','emit','deactivateUser','_initializeTime','then','exports','activity','_serverStartTime','heartbeat','_handleUserActivity','User','serverTime','_heartbeat','broadcast','userActivity','sceneId','disconnect','string','_onActivate','Setting','_onGameTime','active','worldTime','users','sockets'];(function(_0x359787,_0x3632bf){const _0x1c021f=function(_0x445063){while(--_0x445063){_0x359787['push'](_0x359787['shift']());}};_0x1c021f(++_0x3632bf);}(_0x3632,0x145));const _0x1c02=function(_0x359787,_0x3632bf){_0x359787=_0x359787-0x0;let _0x1c021f=_0x3632[_0x359787];return _0x1c021f;};const util=require(_0x1c02('0x9'));class Activity{constructor(){this[_0x1c02('0x6')]={};this[_0x1c02('0x5')]=0x0;this[_0x1c02('0x1b')]=Date[_0x1c02('0x13')]();this[_0x1c02('0x20')]=setInterval(()=>this[_0x1c02('0x1c')](this),0x3a98);this[_0x1c02('0x17')]();}[_0x1c02('0x17')](){db[_0x1c02('0x2')][_0x1c02('0xe')](_0x1c02('0xd'))[_0x1c02('0x18')](_0x584898=>{if(_0x584898===null)db[_0x1c02('0x2')]['set'](_0x1c02('0xd'),0x0);this[_0x1c02('0x5')]=parseInt(_0x584898)||0x0;});}get['serverTime'](){return Date['now']()-this[_0x1c02('0x1b')];}[_0x1c02('0x1c')](){if(!game[_0x1c02('0x6')])return;for(let _0x185cb2 of game[_0x1c02('0x6')]){if(!(_0x185cb2[_0x1c02('0x11')]in this[_0x1c02('0x6')]))continue;if(_0x185cb2[_0x1c02('0x7')][_0x1c02('0xf')]===0x0)this[_0x1c02('0x16')](_0x185cb2);}}['activateUser'](_0x3e5bbc){const {express,game,db}=global;if(typeof _0x3e5bbc===_0x1c02('0x0'))_0x3e5bbc=game[_0x1c02('0x6')]['find'](_0x28e46a=>_0x28e46a[_0x1c02('0x11')]===_0x3e5bbc);if(!(_0x3e5bbc instanceof db[_0x1c02('0x1e')]))return![];if(!(_0x3e5bbc[_0x1c02('0x11')]in this[_0x1c02('0x6')]))return![];this[_0x1c02('0x6')][_0x3e5bbc['_id']]={};express['io'][_0x1c02('0x15')]('userActivity',_0x3e5bbc[_0x1c02('0x11')],{'active':!![]});return!![];}[_0x1c02('0x16')](_0x5f2b19){const {express,game,db}=global;if(typeof _0x5f2b19===_0x1c02('0x0'))_0x5f2b19=game[_0x1c02('0x6')][_0x1c02('0x14')](_0x411647=>_0x411647[_0x1c02('0x11')]===_0x5f2b19);if(!(_0x5f2b19 instanceof db[_0x1c02('0x1e')]))return![];if(!(_0x5f2b19[_0x1c02('0x11')]in this['users']))return![];if(_0x5f2b19[_0x1c02('0x7')]['length'])return![];delete this[_0x1c02('0x6')][_0x5f2b19[_0x1c02('0x11')]];express['io']['emit'](_0x1c02('0x22'),_0x5f2b19['_id'],{'active':![]});return!![];}static[_0x1c02('0xb')](_0x450a70){this[_0x1c02('0x1')](_0x450a70,!![]);_0x450a70['on'](_0x1c02('0x24'),()=>this['_onActivate'](_0x450a70,![]));_0x450a70['on'](_0x1c02('0x22'),(_0x1dac91,_0x521491)=>this[_0x1c02('0x1d')](_0x450a70,_0x1dac91,_0x521491));_0x450a70['on'](_0x1c02('0x10'),_0x546af9=>this[_0x1c02('0x10')](_0x450a70,_0x546af9));_0x450a70['on']('time',this[_0x1c02('0x3')]);}static['_onActivate'](_0x2dab0b,_0x55c729){const {game}=global;if(!game[_0x1c02('0xa')]||!game[_0x1c02('0x1a')]||!_0x2dab0b[_0x1c02('0xc')])return;if(_0x55c729)game[_0x1c02('0x1a')]['activateUser'](_0x2dab0b[_0x1c02('0xc')]);else game[_0x1c02('0x1a')][_0x1c02('0x16')](_0x2dab0b[_0x1c02('0xc')]);}static async['_onGameTime'](_0x167227){const {game}=global;if(!game[_0x1c02('0xa')]||!game[_0x1c02('0x1a')])return _0x167227({});return _0x167227({'serverTime':game[_0x1c02('0x1a')][_0x1c02('0x1f')],'worldTime':game[_0x1c02('0x1a')][_0x1c02('0x5')]});}static[_0x1c02('0x10')](_0x4fe0b5,_0x3eb594){if(!game['ready'])return;global[_0x1c02('0x12')][_0x1c02('0x8')]('Toggling\x20game\x20pause\x20status\x20to\x20'+_0x3eb594);game['paused']=_0x3eb594;_0x4fe0b5['broadcast']['emit'](_0x1c02('0x10'),_0x3eb594);}static[_0x1c02('0x1d')](_0x326ac4,_0x2201a8,_0x3e0dfe={}){if(!game[_0x1c02('0xa')]||!game['activity'])return;const _0x37bc8b=game[_0x1c02('0x1a')][_0x1c02('0x6')];if(!(_0x2201a8 in _0x37bc8b))_0x37bc8b[_0x2201a8]={};const _0x30b042=_0x37bc8b[_0x2201a8];_0x30b042[_0x1c02('0x4')]=!![];for(let _0x2d5317 of[_0x1c02('0x23'),'cursor','targets']){if(_0x2d5317 in _0x3e0dfe)_0x30b042[_0x2d5317]=_0x3e0dfe[_0x2d5317];}_0x326ac4[_0x1c02('0x21')][_0x1c02('0x15')](_0x1c02('0x22'),_0x2201a8,_0x3e0dfe);}}module[_0x1c02('0x19')]={'Activity':Activity};
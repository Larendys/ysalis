const _0x352c=['assign','headers','\x20for\x20User\x20','port','needsSignature','User','session','SHA256','cookie','info','getOrCreate','isValidKeyFormat','Deactivating\x20session\x20','stringify','expire','json','signature','SOFTWARE_DOWNLOAD_URL','pbkdf2Sync','\x20does\x20not\x20have\x20permission\x20to\x20access\x20this\x20World.','isAbsolute','activity','write','logoutAdmin','The\x20path\x20to\x20requested\x20user\x20data\x20location\x20','expandObject','hex','\x20did\x20not\x20contain\x20a\x20valid\x20configuration.','messages','setMessage','./common/utils','Failed\x20to\x20write\x20License\x20file:\x0a','isNewerVersion','body','normalize','PUBLIC_KEY','failed','sign','License\x20verification\x20failed.\x20Please\x20confirm\x20your\x20Foundry\x20Virtual\x20Tabletop\x20software\x20license','message','STATUSES','startsWith','error','hasValidKey','exports','clearCookie','https://foundryvtt.com/_api/license/validate/','The\x20requested\x20User\x20ID\x20','https://foundryvtt.com/_api/license/sign/','path','applyLicense','stack','LICENSE_API_KEY','The\x20data\x20path\x20','node-fetch','name','en.core','verify','get','Invalid\x20license\x20key\x20format','key','version','game','admin','findOne','parse','constructor','sslKey','SOFTWARE_UPDATE_URL','envOptions','A\x20service.json\x20configuration\x20file\x20was\x20present,\x20but\x20failed\x20to\x20be\x20loaded:\x20','ERROR.InvalidAdminKey','Service-Provider','basename','adminKey','join','sep','Software\x20license\x20requires\x20EULA\x20signature.','base64','worlds','data','includes','hasOwnProperty','Revoked\x20admin\x20access\x20for\x20session\x20','trim','isObjectEmpty','success','Administrator\x20authentication\x20failed\x20for\x20session\x20','LICENSE_VALIDATION_URL','userOptions','now','duplicate','deactivateUser','license','The\x20provided\x20AWS\x20configuration\x20path\x20','replace','active','0.0.0','split','posix','https://foundryvtt.com/_api/license/update/','sessions','level','release','User\x20authentication\x20failed\x20for\x20user\x20','Admin\x20authentication\x20successful','relative','-----BEGIN\x20PUBLIC\x20KEY-----\x0aMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAuWBSnz/TfOKdEpEPj9Gf\x0a7kFS82sBd5mdcT6it9P/gd/wkFehG0cm5nB+gmpt4ZMAJLCnWzHwL4ih5pKoINy6\x0azqOhw0bzk2PjifQI1bcclmdmP+t2oE/GJOZ1BM7HFgPW8kiWRpFxTXJh6ooB2wb9\x0aSx89ABLvRIfzpKmuEl9qBKk9w7X+3yPCiZ5FvggCxQLvSkvDMOPZDxVDV3yQvFkO\x0aaDFmhyMFPNnInWXEOYXR31IR3kgnIWC6Hjtw0TlpUHzz/j6aHXWfQu5kwM89HjaF\x0aiPzhDdYWQZKaSTnXt7oNkyfccW7YdIONDf0xJ+lNPOe9OO0HRjhdLiLVwSMr965D\x0a+PBOkwLYlDlOgEQRZIzi88tsNFOX31BInaG2F8yhsDkQ16FK3A+04pfEYZp1H+mC\x0aMTWi274Od4i1NYctOS2bNwb2U1dMtwt2ZZmgbHSMv1fm1R/9iAfLrSDjgTbmhquA\x0aorVCmzl1mTG8o0xE9IX5psH3bDJxVis1IeUBeMd+Js0dsY9jIU0uN9D0wke8C7cf\x0aUK6XzZkC5ujQl92WAKeQOtxkG7e1x5cq4T1tkaH/U4HJWdcAsN0qohQ4vV73Akpm\x0ab7ZzUrMFv9BdIfUXgNZuQutkfXgfrAFznjI/H9R1M2uQBbQnk+I7+/wA49DJND4s\x0au3WiTypPaz1INacKD9bplx0CAwEAAQ==\x0a-----END\x20PUBLIC\x20KEY-----','createVerify','Incorrect\x20access\x20key\x20provided\x20for\x20user\x20','User\x20','push','authenticateAdmin','VALID','License\x20signature\x20server\x20was\x20unable\x20to\x20be\x20reached.\x20Ensure\x20you\x20are\x20connected\x20to\x20the\x20internet\x20with\x20outbound\x20traffic\x20allowed.','resources','filterObject','writeFileSync','The\x20requested\x20','INVALID','awsConfig','diffObject','end','boolean','proxySSL','Software\x20license\x20requires\x20signature.','foundryvtt_hkmg5t4zxc092e31mkfbg3','dirname','NONE','\x20must\x20not\x20be\x20inside\x20the\x20application\x20location\x20','LICENSE_SIGNATURE_URL','\x20out\x20of\x20active\x20World','sha512','status','length','password','config','fromConfig','https://foundryvtt.com/_api/license/download/','test','./files/s3','dataPath','_id','readFileSync','upnp','warn','getDate',';\x20invalid\x20password','mergeObject','_create','Logged\x20user\x20','world','createPublicKey','expires','service','randomID','The\x20application\x20port\x20must\x20be\x20an\x20integer,\x20either\x2080,\x20443,\x20or\x20between\x201024\x20and\x2065535','Login\x20successful,\x20joining\x20game!','existsSync','logger','root','utf8','paths','./common/constants','application/json','Expiring\x20client\x20session\x20','options','\x20does\x20not\x20exist.','Invalid\x20license\x20key\x20format\x20detected,\x20expiring\x20license\x20file.'];(function(_0x287d56,_0x352cf0){const _0x9164e=function(_0x46051c){while(--_0x46051c){_0x287d56['push'](_0x287d56['shift']());}};_0x9164e(++_0x352cf0);}(_0x352c,0x10e));const _0x9164=function(_0x287d56,_0x352cf0){_0x287d56=_0x287d56-0x0;let _0x9164e=_0x352c[_0x287d56];return _0x9164e;};const cookie=require(_0x9164('0x4c'));const crypto=require('crypto');const fetch=require(_0x9164('0x7a'));const fs=require('fs');const path=require(_0x9164('0x75'));const util=require(_0x9164('0x62'));const S3FileStorage=require(_0x9164('0x27'));const {EULA_VERSION,PASSWORD_SAFE_STRING,USER_ROLES}=require(_0x9164('0x3e'));const COOKIE_MAX_AGE=0x3e8*0x3c*0x3c*0x18;const _S3KT='17c4f39053ac5a50d5797c665ad1f4e6';const DEFAULT_OPTIONS={'port':0x7530,'upnp':!![],'fullscreen':![],'hostname':null,'routePrefix':null,'sslCert':null,'sslKey':null,'awsConfig':null,'dataPath':null,'proxySSL':![],'proxyPort':null,'minifyStaticFiles':![],'updateChannel':_0x9164('0x2'),'language':_0x9164('0x7c')};class Sessions{constructor(){this[_0x9164('0x0')]={};}[_0x9164('0x44')](_0x3a821d,_0x4e59eb){_0x3a821d[_0x9164('0x4c')](_0x9164('0x4a'),_0x4e59eb['id'],{'maxAge':COOKIE_MAX_AGE});}[_0x9164('0x52')](_0x3178ab,_0x343755){const _0x118fc6=this[_0x9164('0x7e')](_0x3178ab,_0x343755);global[_0x9164('0x3a')][_0x9164('0x4d')](_0x9164('0x40')+_0x118fc6['id']);delete this[_0x9164('0x0')][id];_0x343755[_0x9164('0x71')](_0x9164('0x4a'));}['get'](_0x3d1eb5,_0x18e6d4){const _0x6fb6d=_0x3d1eb5[_0x9164('0x45')][_0x9164('0x4c')]?cookie['parse'](_0x3d1eb5[_0x9164('0x45')][_0x9164('0x4c')]):null;if(!_0x6fb6d||!_0x6fb6d['session'])return null;const _0x34f2e5=_0x6fb6d[_0x9164('0x4a')];const _0x5a1f1f=this[_0x9164('0x0')][_0x34f2e5];if(!_0x5a1f1f)return null;const _0x528d1b=Date[_0x9164('0x9e')]();if(_0x528d1b>_0x5a1f1f[_0x9164('0x34')]){this[_0x9164('0x52')](_0x3d1eb5,_0x18e6d4);return null;}return _0x5a1f1f;}[_0x9164('0x4e')](_0x5cfe63,_0x1d7b60){if(_0x5cfe63[_0x9164('0x4a')])return _0x5cfe63[_0x9164('0x4a')];let _0x4e9c19=this[_0x9164('0x7e')](_0x5cfe63,_0x1d7b60);if(!_0x4e9c19){_0x4e9c19=this[_0x9164('0x30')]();this[_0x9164('0x44')](_0x1d7b60,_0x4e9c19);global[_0x9164('0x3a')][_0x9164('0x4d')]('Created\x20client\x20session\x20'+_0x4e9c19['id']);}return _0x5cfe63[_0x9164('0x4a')]=_0x4e9c19;}[_0x9164('0x30')]({world=null,user=null,admin=![]}={}){const _0x169b8e=util[_0x9164('0x36')](0x18);const _0x589dd3=new Date();const _0x2ea93a=_0x589dd3['setDate'](_0x589dd3[_0x9164('0x2d')]()+0x1);const _0x2b01a4={};if(world&&user){_0x2b01a4[world]=user;}const _0x39d170={'id':_0x169b8e,'admin':admin,'expires':_0x2ea93a,'worlds':_0x2b01a4,'messages':[]};this[_0x9164('0x0')][_0x169b8e]=_0x39d170;for(let _0x598d62 of global['startupMessages']){if(![_0x9164('0x6e'),_0x9164('0x2c')][_0x9164('0x95')](_0x598d62[_0x9164('0x1')]))continue;_0x39d170['messages']['push']({'type':_0x598d62[_0x9164('0x1')],'message':_0x598d62[_0x9164('0x6b')],'options':{'permanent':!![]}});}return _0x39d170;}async['authenticateUser'](_0x249334,_0x33521a){const {game}=global;if(!game['ready']||!game['world'])throw new Error('You\x20cannot\x20log\x20until\x20a\x20game\x20World\x20is\x20ready\x20for\x20play.');const _0x397739=this['getOrCreate'](_0x249334,_0x33521a);const {userid,password}=_0x249334[_0x9164('0x65')];const _0x11182d=await db[_0x9164('0x49')][_0x9164('0x84')]({'_id':userid});if(_0x11182d===null){_0x33521a[_0x9164('0x20')](0x193);return{'request':'join','status':_0x9164('0x68'),'error':_0x9164('0x73')+userid+_0x9164('0x42')};}if(_0x11182d[_0x9164('0x22')]&&password!==_0x11182d[_0x9164('0x22')]){logger[_0x9164('0x2c')](_0x9164('0x3')+_0x11182d[_0x9164('0x7b')]+_0x9164('0x2e'),{'status':0x193,'ip':_0x249334['ip']});_0x33521a[_0x9164('0x20')](0x193);return{'request':'join','status':_0x9164('0x68'),'error':_0x9164('0x8')+_0x11182d['name']+'.'};}if(_0x11182d['role']===USER_ROLES[_0x9164('0x1b')]){_0x33521a[_0x9164('0x20')](0x193);return{'request':_0x9164('0x8f'),'status':_0x9164('0x68'),'error':_0x9164('0x9')+_0x11182d[_0x9164('0x7b')]+_0x9164('0x57')};}_0x397739[_0x9164('0x93')][game[_0x9164('0x32')]['id']]=_0x11182d[_0x9164('0x29')];global[_0x9164('0x3a')][_0x9164('0x4d')]('User\x20authentication\x20successful\x20for\x20user\x20'+_0x11182d[_0x9164('0x7b')]);return{'request':'join','status':_0x9164('0x9a'),'message':_0x9164('0x38'),'redirect':_0x249334['baseUrl']+'/game'};}[_0x9164('0xb')](_0x56f43a,_0x411023){const {logger}=config;const _0x3a7c7b=this['getOrCreate'](_0x56f43a,_0x411023);const _0x3cbc71=config[_0x9164('0x8e')];if(_0x3a7c7b['admin']||!_0x3cbc71)return{'success':!![],'session':_0x3a7c7b};let _0x4bc289=![];if(_0x56f43a[_0x9164('0x65')]&&_0x56f43a[_0x9164('0x65')][_0x9164('0x96')](_0x9164('0x8e'))){_0x4bc289=testPassword(_0x56f43a[_0x9164('0x65')][_0x9164('0x8e')],_0x3cbc71);if(_0x4bc289){logger['info']('Administrator\x20authentication\x20successful\x20for\x20session\x20'+_0x3a7c7b['id']);_0x3a7c7b[_0x9164('0x60')][_0x9164('0xa')]({'type':_0x9164('0x4d'),'message':_0x9164('0x4')});}else{_0x411023[_0x9164('0x20')](0x193);logger[_0x9164('0x2c')](_0x9164('0x9b')+_0x3a7c7b['id']+';\x20invalid\x20password',{'status':0x193,'ip':_0x56f43a['ip']});_0x3a7c7b['messages'][_0x9164('0xa')]({'type':'error','message':_0x9164('0x8b'),'options':{'permanent':!![]}});}}_0x3a7c7b[_0x9164('0x83')]=_0x4bc289;return{'success':_0x4bc289,'session':_0x3a7c7b};}['getMessages'](_0xf30f4a){if(!_0xf30f4a[_0x9164('0x4a')])return null;const _0x127b2a=_0xf30f4a['session'][_0x9164('0x60')];_0xf30f4a[_0x9164('0x4a')][_0x9164('0x60')]=[];return _0x127b2a[_0x9164('0x21')]?JSON[_0x9164('0x51')](_0x127b2a):null;}[_0x9164('0x61')](_0x8d3507,_0x1a4707,_0x44d97f,_0x249b36){const _0x527496=this[_0x9164('0x7e')](_0x8d3507,_0x1a4707);if(!_0x527496)return;_0x527496['messages']['push']({'type':_0x44d97f,'message':_0x249b36});}[_0x9164('0x5b')](_0x3d858d,_0x9357c2){const _0x6bd303=this['get'](_0x3d858d,_0x9357c2);if(!_0x6bd303)return;_0x6bd303[_0x9164('0x83')]=![];logger[_0x9164('0x4d')](_0x9164('0x97')+_0x6bd303['id']);}['logoutWorld'](_0x2af5a3,_0x1a425a){const _0x5565cd=global[_0x9164('0x82')];if(!_0x5565cd[_0x9164('0xa4')])return;const _0x3ff5ed=this['get'](_0x2af5a3,_0x1a425a);if(!_0x3ff5ed)return;const _0x3f7b60=_0x3ff5ed['worlds'][_0x5565cd['world']['id']];delete _0x3ff5ed['worlds'][_0x5565cd[_0x9164('0x32')]['id']];if(_0x3f7b60){const _0x57d166=_0x5565cd[_0x9164('0x59')][_0x9164('0xa0')](_0x3f7b60);if(_0x57d166)global[_0x9164('0x3a')][_0x9164('0x4d')](_0x9164('0x31')+_0x3f7b60+_0x9164('0x1e'));}}['deactivateUserSession'](_0xe5c141){for(let [_0x154fd6,_0x2925a2]of Object['entries'](this[_0x9164('0x0')])){if(_0x2925a2[_0x9164('0x93')][game[_0x9164('0x32')]['id']]===_0xe5c141){global[_0x9164('0x3a')]['info'](_0x9164('0x50')+_0x154fd6+_0x9164('0x46')+_0xe5c141);delete this[_0x9164('0x0')][_0x154fd6];}}}}const sessions=new Sessions();function getPassword(_0x4bf5c1){const _0x3e8a2e=crypto[_0x9164('0x56')](_0x4bf5c1,_S3KT,0x3e8,0x40,_0x9164('0x1f'));return _0x3e8a2e['toString'](_0x9164('0x5e'));}function testPassword(_0x234cc1,_0x13a966){if(_0x13a966==='')return _0x234cc1==='';const _0x255c6=crypto['pbkdf2Sync'](_0x234cc1,_S3KT,0x3e8,0x40,'sha512');return _0x255c6['toString'](_0x9164('0x5e'))===_0x13a966;}class License{constructor(_0x3a8dde){this['data']=this['constructor']['get']();this[_0x9164('0x20')]=this['constructor'][_0x9164('0x6c')][_0x9164('0x1b')];this[_0x9164('0x35')]=_0x3a8dde;}static get[_0x9164('0x75')](){return path[_0x9164('0x8f')](global[_0x9164('0x3d')][_0x9164('0x23')],'license.json');}static['get'](){if(!fs[_0x9164('0x39')](this[_0x9164('0x75')]))return{};try{return JSON['parse'](fs['readFileSync'](this[_0x9164('0x75')],_0x9164('0x3c')));}catch(_0x3426dd){_0x3426dd[_0x9164('0x6b')]='Unable\x20to\x20read\x20software\x20license\x20file:\x0a'+_0x3426dd['message'];global[_0x9164('0x3a')]['error'](_0x3426dd);return{};}}get['license'](){return this[_0x9164('0x94')][_0x9164('0xa1')]||null;}get[_0x9164('0x80')](){const _0xfeb555={'host':this['service']['id'],'license':this['data'][_0x9164('0xa1')],'version':EULA_VERSION};return JSON[_0x9164('0x51')](_0xfeb555);}get[_0x9164('0x48')](){const _0xf84ef8=this[_0x9164('0x86')][_0x9164('0x6c')];return[_0xf84ef8['NONE'],_0xf84ef8['INVALID']][_0x9164('0x95')](this[_0x9164('0x20')]);}get[_0x9164('0x6f')](){return this[_0x9164('0x4f')](this[_0x9164('0x94')][_0x9164('0xa1')]);}[_0x9164('0x4f')](_0x3f4db5){return/^[A-Z0-9]{24}$/['test'](_0x3f4db5);}[_0x9164('0x76')](_0x12be81){if(!_0x12be81)return this[_0x9164('0x5a')]({'license':null,'signature':null});_0x12be81=_0x12be81[_0x9164('0xa3')](/\-/g,'')[_0x9164('0x98')]();const _0x6e0a6=this[_0x9164('0x4f')](_0x12be81);if(!_0x6e0a6)throw new Error(_0x9164('0x7f'));return this[_0x9164('0x5a')]({'license':_0x12be81,'signature':undefined});}async[_0x9164('0x69')](){const _0x1ad752={'Content-Type':_0x9164('0x3f'),'Authorization':'APIKey:'+this[_0x9164('0x86')][_0x9164('0x78')]};if(this[_0x9164('0x35')][_0x9164('0x80')])_0x1ad752[_0x9164('0x8c')]=this[_0x9164('0x35')]['id']+':'+this[_0x9164('0x35')][_0x9164('0x80')];const _0x44bf6a=await fetch(this['constructor']['LICENSE_SIGNATURE_URL'],{'headers':_0x1ad752,'method':'POST','body':this[_0x9164('0x80')]});if(_0x44bf6a['status']!==0xc8){throw new Error(_0x9164('0xd'));}const _0xc35189=await _0x44bf6a[_0x9164('0x53')]();if(_0xc35189[_0x9164('0x20')]==='error'){logger['error'](_0xc35189[_0x9164('0x6b')]);return _0xc35189;}this[_0x9164('0x5a')]({'signature':_0xc35189[_0x9164('0x54')]});const _0x2c0c82='License\x20signature\x20successfully\x20created.\x20Thank\x20you\x20and\x20please\x20enjoy\x20Foundry\x20Virtual\x20Tabletop.';logger[_0x9164('0x4d')](_0x2c0c82);this[_0x9164('0x7d')]();return{'status':'success','message':_0x2c0c82};}['verify'](){if(this[_0x9164('0x94')][_0x9164('0xa1')]&&!this['isValidKeyFormat'](this[_0x9164('0x94')][_0x9164('0xa1')])){global[_0x9164('0x3a')][_0x9164('0x2c')](_0x9164('0x43'));fs['unlinkSync'](License[_0x9164('0x75')]);this['data']={};}const _0x4c48b6=this[_0x9164('0x94')];const _0x5cee36=this[_0x9164('0x86')][_0x9164('0x6c')];if(!_0x4c48b6[_0x9164('0x54')]){global[_0x9164('0x3a')][_0x9164('0x2c')](_0x9164('0x18'));return this[_0x9164('0x20')]=_0x5cee36[_0x9164('0x1b')];}if(util[_0x9164('0x64')](EULA_VERSION,_0x4c48b6[_0x9164('0x81')]||_0x9164('0xa5'))){global[_0x9164('0x3a')][_0x9164('0x2c')](_0x9164('0x91'));return this[_0x9164('0x20')]=_0x5cee36[_0x9164('0x12')];}const _0x305116=crypto[_0x9164('0x33')](this[_0x9164('0x86')][_0x9164('0x67')]);const _0x28601e=crypto[_0x9164('0x7')](_0x9164('0x4b'));_0x28601e[_0x9164('0x5a')](this[_0x9164('0x80')]);_0x28601e['end']();const _0x40bc5f=_0x28601e[_0x9164('0x7d')](_0x305116,_0x4c48b6[_0x9164('0x54')],_0x9164('0x92'));if(_0x40bc5f){global[_0x9164('0x3a')][_0x9164('0x4d')]('License\x20verification\x20succeeded');return this[_0x9164('0x20')]=_0x5cee36[_0x9164('0xc')];}else{const _0x20aa96=_0x9164('0x6a');global[_0x9164('0x3a')][_0x9164('0x6e')](_0x20aa96);return this[_0x9164('0x20')]=_0x5cee36['INVALID'];}}[_0x9164('0x5a')]({license,signature}={}){const _0x109b4d={'host':this['service']['id'],'license':license!==undefined?license:this[_0x9164('0x94')][_0x9164('0xa1')],'version':EULA_VERSION,'time':new Date(),'signature':signature!==undefined?signature:this[_0x9164('0x94')]['signature']};try{fs[_0x9164('0x10')](this[_0x9164('0x86')]['path'],JSON[_0x9164('0x51')](_0x109b4d,null,0x2));this[_0x9164('0x94')]=_0x109b4d;}catch(_0x2cf672){const _0x2d9642=new Error(_0x9164('0x63')+_0x2cf672['message']);_0x2d9642[_0x9164('0x77')]=_0x2cf672['stack'];throw _0x2d9642;}}}License[_0x9164('0x9c')]=_0x9164('0x72');License[_0x9164('0x1d')]=_0x9164('0x74');License[_0x9164('0x88')]=_0x9164('0xa8');License[_0x9164('0x55')]=_0x9164('0x25');License[_0x9164('0x78')]=_0x9164('0x19');License[_0x9164('0x6c')]={'NONE':0x0,'INVALID':0x1,'VALID':0x2,'UNKNOWN':0x3};License[_0x9164('0x67')]=_0x9164('0x6');function updateCoreOptions(_0x222168){const _0x35770e=_0x222168[_0x9164('0x4a')]&&_0x222168[_0x9164('0x4a')][_0x9164('0x83')];const _0x558f97=!!config[_0x9164('0x8e')];const _0x3f2a3b=!game[_0x9164('0xa4')]&&(_0x35770e||!_0x558f97);if(!_0x3f2a3b)return{'redirect':'/setup'};const _0x48760a=util[_0x9164('0x5d')](_0x222168[_0x9164('0x65')])[_0x9164('0x41')];const _0x1c5371=util[_0x9164('0x9f')](config[_0x9164('0x9d')]);let _0x2f76a6=![];if('adminKey'in _0x48760a){_0x2f76a6=updateAdministratorPassword(_0x48760a[_0x9164('0x8e')]);delete _0x48760a[_0x9164('0x8e')];}const _0x50ee0a=updateUserOptions(_0x48760a);const _0x12d648=util[_0x9164('0x14')](_0x1c5371,_0x50ee0a);const _0x4a489a=util[_0x9164('0x14')](_0x50ee0a,_0x1c5371);let _0x1812ca=!util['isObjectEmpty'](_0x12d648)||!util[_0x9164('0x99')](_0x4a489a);if('dataPath'in _0x12d648){fs[_0x9164('0x10')](paths[_0x9164('0x89')],JSON[_0x9164('0x51')](config[_0x9164('0x9d')],null,0x2));}if(_0x1812ca||_0x2f76a6){global[_0x9164('0x3a')][_0x9164('0x2c')]('Application\x20configuration\x20settings\x20updated,\x20server\x20restart\x20required!');process['exit']();return{'shutdown':!![]};}return{'redirect':'/setup'};}function updateUserOptions(_0x21b91a){_0x21b91a=util[_0x9164('0xf')](_0x21b91a,DEFAULT_OPTIONS);if(_0x9164('0x28')in _0x21b91a){const _0x411880=path[_0x9164('0x66')](_0x21b91a['dataPath'])[_0x9164('0xa6')](path[_0x9164('0x90')])['join'](path[_0x9164('0xa7')][_0x9164('0x90')]);if(!fs[_0x9164('0x39')](path[_0x9164('0x1a')](_0x411880))){throw new Error(_0x9164('0x5c')+_0x411880+_0x9164('0x42'));}const _0xd73576=path[_0x9164('0x1a')](paths['root']);const _0x4d3976=path[_0x9164('0x8d')](_0xd73576)===_0x9164('0xe')?path['dirname'](_0xd73576):paths['root'];const _0x23ef7f=path[_0x9164('0x5')](_0x4d3976,_0x411880);if(!(_0x23ef7f[_0x9164('0x6d')]('..')||path[_0x9164('0x58')](_0x23ef7f))){throw new Error(_0x9164('0x79')+_0x411880+_0x9164('0x1c')+paths[_0x9164('0x3b')]+'.');}_0x21b91a['dataPath']=_0x411880;}if('port'in _0x21b91a){let _0x1a2f85=parseInt(_0x21b91a[_0x9164('0x47')]);if(!Number['isNumeric'](_0x1a2f85)||_0x1a2f85<0x400&&![0x50,0x1bb]['includes'](_0x1a2f85)||_0x1a2f85>0xffff){throw new Error(_0x9164('0x37'));}_0x21b91a[_0x9164('0x47')]=_0x1a2f85;}const _0x1bd7d6=[_0x9164('0x2b'),_0x9164('0x17'),'minifyStaticFiles'];for(let _0x11d174 of _0x1bd7d6){if(_0x11d174 in _0x21b91a){const _0x311436=_0x21b91a[_0x11d174];_0x21b91a[_0x11d174]=typeof _0x311436===_0x9164('0x16')?_0x11d174:_0x311436==='true';}}if(_0x9164('0x32')in _0x21b91a){_0x21b91a['world']=_0x21b91a[_0x9164('0x32')]||null;}for(p of['sslCert',_0x9164('0x87'),_0x9164('0x13')]){if(!(p in _0x21b91a))continue;if(_0x21b91a[p]===''){_0x21b91a[p]=null;continue;}if(p===_0x9164('0x13')&&_0x21b91a[p]===!![])continue;const _0x1a06c4=path['normalize'](_0x21b91a[p]||'')[_0x9164('0xa6')](path[_0x9164('0x90')])[_0x9164('0x8f')](path['posix'][_0x9164('0x90')]);if(!fs[_0x9164('0x39')](_0x1a06c4)&&!fs[_0x9164('0x39')](path[_0x9164('0x8f')](paths[_0x9164('0x23')],_0x1a06c4))){throw new Error(_0x9164('0x11')+p+'\x20path\x20'+_0x1a06c4+_0x9164('0x42'));}_0x21b91a[p]=_0x1a06c4;if(p===_0x9164('0x13')){try{S3FileStorage[_0x9164('0x24')](_0x9164('0x26'),_0x1a06c4);}catch(_0x47fca4){throw new Error(_0x9164('0xa2')+p+_0x9164('0x5f'));}}}const _0xc7ef14=util[_0x9164('0x2f')](config[_0x9164('0x9d')],_0x21b91a);fs[_0x9164('0x10')](paths['options'],JSON[_0x9164('0x51')](_0xc7ef14,null,0x2));config['userOptions']=_0xc7ef14;return _0xc7ef14;}function updateAdministratorPassword(_0x17462e){if(_0x17462e===PASSWORD_SAFE_STRING)return;const _0x10a5b2=path[_0x9164('0x8f')](paths[_0x9164('0x23')],'admin.txt');const _0x2890f1=config[_0x9164('0x8e')];if(!_0x17462e){if(fs[_0x9164('0x39')](_0x10a5b2))fs['unlinkSync'](_0x10a5b2);config[_0x9164('0x8e')]=null;}else{const _0x3c7c18=getPassword(_0x17462e);fs[_0x9164('0x10')](_0x10a5b2,_0x3c7c18);config['adminKey']=_0x3c7c18;}const _0x2e427d=_0x2890f1!==config[_0x9164('0x8e')];return _0x2e427d;}function getServiceProviderConfig(_0x3a7050,_0x3f26c6){try{const _0x4801a1=JSON[_0x9164('0x85')](fs[_0x9164('0x2a')](_0x3a7050,'utf8'));const _0x1c5ae4=crypto['createPublicKey'](License[_0x9164('0x67')]);const _0xe2a465=crypto[_0x9164('0x7')]('SHA256');const _0x22631f=JSON[_0x9164('0x51')]({'id':_0x4801a1['id'],'key':_0x3f26c6});_0xe2a465['write'](_0x22631f);_0xe2a465[_0x9164('0x15')]();const _0x4f57f7=_0xe2a465['verify'](_0x1c5ae4,_0x4801a1[_0x9164('0x54')],'base64');if(!_0x4f57f7)throw new Error('Invalid\x20configuration\x20file\x20signature');global[_0x9164('0x3a')]['info']('Service\x20provider\x20configuration\x20successfully\x20loaded\x20for\x20'+_0x4801a1['id']);_0x4801a1[_0x9164('0x80')]=_0x3f26c6;return _0x4801a1;}catch(_0x6f792){_0x6f792[_0x9164('0x6b')]=_0x9164('0x8a')+_0x6f792[_0x9164('0x6b')];global[_0x9164('0x3a')][_0x9164('0x6e')](_0x6f792);return null;}}module[_0x9164('0x70')]={'getPassword':getPassword,'getServiceProviderConfig':getServiceProviderConfig,'sessions':sessions,'updateCoreOptions':updateCoreOptions,'updateUserOptions':updateUserOptions,'License':License,'DEFAULT_OPTIONS':DEFAULT_OPTIONS};
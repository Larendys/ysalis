const _0x4200=['data','title','check','error','isActive','This\x20option\x20is\x20not\x20available\x20for\x20servers\x20running\x20in\x20demo\x20mode','users','eula','quit','FILES_UPLOAD','refresh\x20this\x20page.','main','needsSignature','body','fatalError','authenticateAdmin','filter','launch','admin','uninstallPackage','ui/denim075.png','messages','./auth','resetPackages','key','logoutAdmin','system','createWorld','join','background','version','json','findOne','applyLicense','logoutWorld','home','sessions','stack','/join','styles','nextSession','method','./packages/world','installPackage','Uh-oh,\x20a\x20problem\x20occurred','user','active','world','There\x20currently\x20no\x20active\x20game\x20session.\x20Please\x20wait\x20for\x20the\x20host\x20to\x20configure\x20the\x20world\x20and\x20then\x20','ready','session','options','baseUrl','failed','No\x20Active\x20Game','vtt\x20players\x20','background-image:\x20url(\x27','success','/license','licenseKey','name','app','scripts','launchWorld','getActiveContent','adminAuth','adminKey','serverTime','getRoute','authenticateUser','esmodules','update','action','demo','setMessage','apiStatus','uploadFile','status','bodyClass','/setup','values','length','updateDownload','noWorld','map','updateCheck','upload','hasPermission','updater','editWorld','updateCoreOptions','getMessages','/game','getPackages','license','exit','find','The\x20game\x20world\x20has\x20been\x20successfully\x20deactivated','message','checkPackage','./files/files','mergeObject','players','License\x20key\x20entered,\x20please\x20sign\x20the\x20End\x20User\x20License\x20Agreement.','\x20provided','isGM','joinPost','game','decline','User','User\x20','sign','forEach','redirect','POST','render','Unsupported\x20setup\x20configuration\x20action\x20','vtt\x20setup','create','\x20does\x20not\x20have\x20permission\x20to\x20upload\x20files.','pop','adminConfigure','source','./packages/views','ERROR.InvalidAdminKey','adminLogout','getUsers','\x20not\x20found!','info','shutdown','requireAuth','exports'];(function(_0x3c618d,_0x420082){const _0x21de11=function(_0x5af08f){while(--_0x5af08f){_0x3c618d['push'](_0x3c618d['shift']());}};_0x21de11(++_0x420082);}(_0x4200,0x161));const _0x21de=function(_0x3c618d,_0x420082){_0x3c618d=_0x3c618d-0x0;let _0x21de11=_0x4200[_0x3c618d];return _0x21de11;};const Files=require(_0x21de('0xb'));const {World}=require(_0x21de('0x55'));const auth=require(_0x21de('0x41'));const util=require('./common/utils');const packages=require(_0x21de('0x22'));const {ver}=global;class Views{static['quitPost'](_0x5816aa,_0x4aae0d){const {config}=global;const _0x5d2225=auth[_0x21de('0x4f')][_0x21de('0x3a')](_0x5816aa,_0x4aae0d);if(!_0x5d2225['success'])return _0x4aae0d['send']({'status':'failed'});else _0x4aae0d['send']({'status':_0x21de('0x60')});if(config[_0x21de('0x68')])config[_0x21de('0x68')][_0x21de('0x33')]();else process[_0x21de('0x6')]();}static[_0x21de('0x4e')](_0x2cdaab,_0x19da4f){if(config['license'][_0x21de('0x37')])return _0x19da4f[_0x21de('0x18')](_0x2cdaab[_0x21de('0x5f')]+_0x21de('0x65'));if(global['game']['world']){if(!_0x2cdaab[_0x21de('0x58')])return _0x19da4f[_0x21de('0x18')](_0x2cdaab[_0x21de('0x5f')]+_0x21de('0x51'));return _0x19da4f[_0x21de('0x18')](_0x2cdaab['baseUrl']+_0x21de('0x3'));}return _0x19da4f[_0x21de('0x18')](_0x2cdaab['baseUrl']+_0x21de('0x7a'));}static async[_0x21de('0x5')](_0x2acf24,_0x227624){const _0x7f08fa=config[_0x21de('0x5')];if(!_0x7f08fa[_0x21de('0x37')])return _0x227624[_0x21de('0x18')]('/');let _0x423963='key';if(_0x7f08fa[_0x21de('0x5')])_0x423963=_0x21de('0x32');if(_0x2acf24[_0x21de('0x54')]==='POST'&&_0x423963===_0x21de('0x43')){try{_0x7f08fa[_0x21de('0x4c')](_0x2acf24[_0x21de('0x38')]['licenseKey']);auth[_0x21de('0x4f')][_0x21de('0x75')](_0x2acf24,_0x227624,_0x21de('0x27'),_0x21de('0xe'));_0x423963=_0x21de('0x32');}catch(_0x2511fa){auth[_0x21de('0x4f')]['setMessage'](_0x2acf24,_0x227624,'error',_0x2511fa['message']);}}else if(_0x2acf24[_0x21de('0x54')]===_0x21de('0x19')&&_0x423963===_0x21de('0x32')){if(_0x21de('0x13')in _0x2acf24['body']){_0x7f08fa[_0x21de('0x4c')](null);if(config[_0x21de('0x68')])config[_0x21de('0x68')][_0x21de('0x33')]();else process[_0x21de('0x6')]();}const _0x38ca9b=await _0x7f08fa[_0x21de('0x16')]();if(_0x38ca9b[_0x21de('0x78')]===_0x21de('0x64')){auth[_0x21de('0x4f')][_0x21de('0x75')](_0x2acf24,_0x227624,_0x21de('0x27'),_0x38ca9b[_0x21de('0x9')]);return _0x227624[_0x21de('0x18')](_0x2acf24[_0x21de('0x5f')]+_0x21de('0x7a'));}else if(_0x38ca9b[_0x21de('0x78')]==='error'){auth['sessions'][_0x21de('0x75')](_0x2acf24,_0x227624,_0x21de('0x2e'),_0x38ca9b[_0x21de('0x9')]);_0x7f08fa[_0x21de('0x4c')](null);return _0x227624[_0x21de('0x18')](_0x2acf24[_0x21de('0x5f')]+_0x21de('0x65'));}}return _0x227624[_0x21de('0x1a')](_0x21de('0x5'),{'layout':'main','bodyClass':'vtt\x20setup','licenseKey':_0x2acf24['body'][_0x21de('0x66')],'step':_0x423963,'isEULA':_0x423963===_0x21de('0x32'),'messages':auth[_0x21de('0x4f')][_0x21de('0x2')](_0x2acf24)});}static[_0x21de('0x7e')](_0x28918d,_0x572fa8){return this['error'](_0x28918d,_0x572fa8,{'title':_0x21de('0x61'),'message':_0x21de('0x5b')+_0x21de('0x35')});}static[_0x21de('0x2e')](_0x1f3da4,_0x120601,..._0xe7e835){const _0x4b71ad=_0xe7e835[_0x21de('0x1f')]()||global[_0x21de('0x39')];_0x120601['render'](_0x21de('0x2e'),{'layout':'main','title':_0x4b71ad[_0x21de('0x2c')]||_0x21de('0x57'),'message':_0x4b71ad['message']||'Something\x20went\x20wrong\x20with\x20the\x20Foundry\x20VTT\x20server','stack':_0x4b71ad[_0x21de('0x50')]||null});}static async['setup'](_0x3b9200,_0x31a1b7){const _0x583d37={'layout':_0x21de('0x36'),'bodyClass':_0x21de('0x1c'),'requireAuth':![]};if(config[_0x21de('0x5')][_0x21de('0x37')])return _0x31a1b7['redirect'](_0x3b9200['baseUrl']+_0x21de('0x65'));if(global[_0x21de('0x12')][_0x21de('0x5a')]){if(!_0x3b9200[_0x21de('0x58')])return _0x31a1b7[_0x21de('0x18')](_0x3b9200[_0x21de('0x5f')]+_0x21de('0x51'));else return _0x31a1b7['redirect'](_0x3b9200[_0x21de('0x5f')]+_0x21de('0x3'));}const _0x53905d=auth[_0x21de('0x4f')][_0x21de('0x3a')](_0x3b9200,_0x31a1b7);if(!_0x53905d[_0x21de('0x64')]){_0x583d37[_0x21de('0x29')]=!![];_0x583d37[_0x21de('0x79')]+='\x20auth';}_0x583d37[_0x21de('0x40')]=auth[_0x21de('0x4f')][_0x21de('0x2')](_0x3b9200);_0x31a1b7[_0x21de('0x1a')]('setup',_0x583d37);}static async['setupPost'](_0xff926d,_0x3b9077){let _0x28ef74={};const {config,game}=global;const _0x1340e2=util[_0x21de('0x6f')]('setup');const _0x41f861=_0xff926d[_0x21de('0x38')][_0x21de('0x73')];const _0x5b6969=auth[_0x21de('0x4f')][_0x21de('0x3a')](_0xff926d,_0x3b9077);let _0x3048d4=game['world']?![]:_0x5b6969[_0x21de('0x64')];if(game[_0x21de('0x5a')]&&_0xff926d['body'][_0x21de('0x28')]){_0x28ef74=await game[_0x21de('0x5a')]['deactivate'](_0xff926d,{'asAdmin':_0x3048d4});return _0x3b9077[_0x21de('0x18')](_0x28ef74[_0x21de('0x18')]);}if(!_0x3048d4&&_0x41f861!=='adminAuth'){_0x3b9077[_0x21de('0x78')](0x193);return _0x3b9077[_0x21de('0x4a')]({'error':'You\x20lack\x20server\x20administrator\x20permission\x20to\x20submit\x20this\x20request.'});}try{switch(_0x41f861){case _0x21de('0x6c'):_0x28ef74={'redirect':_0x1340e2};break;case _0x21de('0x24'):auth[_0x21de('0x4f')][_0x21de('0x44')](_0xff926d,_0x3b9077);_0x28ef74={'redirect':_0x1340e2};break;case _0x21de('0x20'):_0x28ef74=auth[_0x21de('0x1')](_0xff926d);break;case _0x21de('0xa'):_0x28ef74=await packages[_0x21de('0xa')](_0xff926d[_0x21de('0x38')]);break;case _0x21de('0x4'):_0x28ef74=await packages[_0x21de('0x4')](_0xff926d[_0x21de('0x38')]);break;case _0x21de('0x56'):_0x28ef74=await packages[_0x21de('0x56')](_0xff926d[_0x21de('0x38')]);break;case _0x21de('0x42'):_0x28ef74=await packages[_0x21de('0x42')](_0xff926d[_0x21de('0x38')]);break;case _0x21de('0x3e'):_0x28ef74=await packages[_0x21de('0x3e')](_0xff926d[_0x21de('0x38')]);break;case _0x21de('0x46'):_0x28ef74=World[_0x21de('0x1d')](_0xff926d[_0x21de('0x38')]);break;case _0x21de('0x0'):_0x28ef74=World[_0x21de('0x72')](_0xff926d[_0x21de('0x38')]);break;case _0x21de('0x6a'):_0x28ef74=await World[_0x21de('0x3c')](_0xff926d[_0x21de('0x38')][_0x21de('0x5a')]);break;case _0x21de('0x80'):_0x28ef74=await config[_0x21de('0x83')][_0x21de('0x2d')](_0xff926d[_0x21de('0x38')]);break;case _0x21de('0x7d'):_0x28ef74=await config['updater'][_0x21de('0x72')]();break;default:throw new Error(_0x21de('0x1b')+_0x41f861+_0x21de('0xf'));}}catch(_0x1e828c){_0x28ef74={'error':_0x1e828c[_0x21de('0x9')],'stack':_0x1e828c['stack']};}if(_0x28ef74[_0x21de('0x18')])return _0x3b9077[_0x21de('0x18')](_0xff926d[_0x21de('0x5f')]+_0x28ef74[_0x21de('0x18')]);return _0x3b9077[_0x21de('0x4a')](_0x28ef74);}static async[_0x21de('0x47')](_0x560faf,_0x1fce91){const {db,game}=global;if(!game['world'])return Views[_0x21de('0x7e')](_0x560faf,_0x1fce91);if(!game[_0x21de('0x5c')])return setTimeout(()=>Views[_0x21de('0x47')](_0x560faf,_0x1fce91),0x3e8);auth[_0x21de('0x4f')][_0x21de('0x4d')](_0x560faf,_0x1fce91);const _0x3eb683=await db['User'][_0x21de('0x25')]();_0x3eb683[_0x21de('0x17')](_0x1e2c70=>_0x1e2c70[_0x21de('0x59')]=_0x1e2c70['isActive']);const _0x283c15=game[_0x21de('0x5a')]?game[_0x21de('0x5a')][_0x21de('0x48')]:null;return _0x1fce91['render'](_0x21de('0x47'),{'users':_0x3eb683,'world':game['world'][_0x21de('0x2b')],'bodyClass':_0x21de('0x62')+(_0x283c15?_0x21de('0x48'):''),'bodyStyle':'background-image:\x20url(\x27'+(_0x283c15||_0x21de('0x3f'))+'\x27)','usersCurrent':_0x3eb683[_0x21de('0x3b')](_0xf00ef=>_0xf00ef[_0x21de('0x2f')])[_0x21de('0x7c')],'usersMax':_0x3eb683['length'],'messages':auth['sessions']['getMessages'](_0x560faf),'nextDatetime':game[_0x21de('0x5a')][_0x21de('0x2b')][_0x21de('0x53')]});}static async[_0x21de('0x11')](_0x437870,_0x228f46){const {config,game}=global;if(!game[_0x21de('0x5a')])return Views[_0x21de('0x7e')](_0x437870,_0x228f46);let _0xfa20d3={};switch(_0x437870[_0x21de('0x38')][_0x21de('0x73')]){case _0x21de('0x28'):if(config['options'][_0x21de('0x74')]){_0xfa20d3[_0x21de('0x78')]=_0x21de('0x60');_0xfa20d3[_0x21de('0x9')]=_0x21de('0x30');break;}if(!config[_0x21de('0x6d')]){_0xfa20d3[_0x21de('0x78')]=_0x21de('0x60');_0xfa20d3['message']=_0x21de('0x23');break;}const _0x4d8c9e=auth['sessions'][_0x21de('0x3a')](_0x437870,_0x228f46);if(_0x4d8c9e[_0x21de('0x64')]){_0xfa20d3=await game[_0x21de('0x5a')]['deactivate'](_0x437870,{'asAdmin':!![]});_0xfa20d3[_0x21de('0x78')]='success';_0xfa20d3[_0x21de('0x9')]=_0x21de('0x8');}else{_0xfa20d3[_0x21de('0x78')]='failed';_0xfa20d3[_0x21de('0x2e')]=_0x437870[_0x21de('0x5d')][_0x21de('0x40')][_0x21de('0x7f')](_0x2519e6=>_0x2519e6['message'])[_0x21de('0x47')]('\x0a');_0x437870['session'][_0x21de('0x40')]=[];}break;case _0x21de('0x47'):auth[_0x21de('0x4f')][_0x21de('0x4d')](_0x437870,_0x228f46);_0xfa20d3=await auth[_0x21de('0x4f')][_0x21de('0x70')](_0x437870,_0x228f46);break;}return _0x228f46['json'](_0xfa20d3);}static async['game'](_0x21c3ba,_0xa51c77){const {db,game,logger}=global;if(!game[_0x21de('0x5a')])return Views[_0x21de('0x7e')](_0x21c3ba,_0xa51c77);if(!_0x21c3ba[_0x21de('0x58')])return _0xa51c77[_0x21de('0x18')](_0x21c3ba[_0x21de('0x5f')]+_0x21de('0x51'));const _0x26c6ba=await db[_0x21de('0x14')][_0x21de('0x4b')]({'_id':_0x21c3ba['user']});if(!_0x26c6ba){logger[_0x21de('0x2e')](Error(_0x21de('0x15')+_0x21c3ba[_0x21de('0x58')]+'\x20not\x20found!'));return _0xa51c77[_0x21de('0x18')](_0x21c3ba['baseUrl']+_0x21de('0x51'));}const _0x2ca3ee=await game['world'][_0x21de('0x6b')]();_0xa51c77['render'](_0x21de('0x12'),{'layout':_0x21de('0x12'),'scripts':_0x2ca3ee[_0x21de('0x69')],'esmodules':_0x2ca3ee[_0x21de('0x71')],'styles':_0x2ca3ee[_0x21de('0x52')]});}static async[_0x21de('0xd')](_0xce6714,_0x43933b){if(!game['world']){_0x43933b[_0x21de('0x18')](_0xce6714[_0x21de('0x5f')]+_0x21de('0x7a'));return![];}const _0x2e97e2=await global['db']['User'][_0x21de('0x25')]();const _0x5c8e61=_0x2e97e2[_0x21de('0x7')](_0x604b1f=>_0x604b1f['_id']===_0xce6714[_0x21de('0x58')]);const _0x6c9398=_0x5c8e61&&_0x5c8e61[_0x21de('0x10')];const _0x2a4567=_0x2e97e2['some'](_0x58a7f9=>_0x58a7f9[_0x21de('0x10')]);let _0x4bb517=_0x6c9398||!_0x2a4567;if(!_0x4bb517){_0x43933b[_0x21de('0x18')](_0xce6714[_0x21de('0x5f')]+_0x21de('0x51'));return![];}const _0x4d947a=game[_0x21de('0x5a')]?game[_0x21de('0x5a')][_0x21de('0x48')]:null;_0x43933b[_0x21de('0x1a')]('players',{'bodyClass':'vtt\x20players\x20'+(_0x4d947a?_0x21de('0x48'):''),'bodyStyle':_0x21de('0x63')+(_0x4d947a||_0x21de('0x3f'))+'\x27)','layout':_0x21de('0x36'),'messages':auth[_0x21de('0x4f')][_0x21de('0x2')](_0xce6714)});}static async['stream'](_0x1c1d19,_0x5e786c){const {db,game,logger}=global;if(!game[_0x21de('0x5a')])return Views['noWorld'](_0x1c1d19,_0x5e786c);if(!_0x1c1d19[_0x21de('0x58')])return _0x5e786c[_0x21de('0x18')](_0x1c1d19['baseUrl']+_0x21de('0x51'));const _0xdc6f7c=await db[_0x21de('0x14')][_0x21de('0x4b')]({'_id':_0x1c1d19[_0x21de('0x58')]});if(!_0xdc6f7c){logger[_0x21de('0x2e')](Error('User\x20'+_0x1c1d19[_0x21de('0x58')]+_0x21de('0x26')));return _0x5e786c[_0x21de('0x18')](_0x1c1d19[_0x21de('0x5f')]+'/join');}const _0x2115da=await game[_0x21de('0x5a')][_0x21de('0x6b')]();_0x5e786c[_0x21de('0x1a')]('stream',{'bodyClass':'stream','layout':_0x21de('0x12'),'scripts':_0x2115da['scripts'],'esmodules':_0x2115da['esmodules'],'styles':_0x2115da[_0x21de('0x52')]});}static[_0x21de('0x76')](_0x1c4921,_0x51d22f){const _0x98d2bf={'active':![],'version':ver};if(game[_0x21de('0x5c')]){util[_0x21de('0xc')](_0x98d2bf,{'active':!![],'world':game[_0x21de('0x5a')]['id'],'system':game[_0x21de('0x45')][_0x21de('0x67')],'systemVersion':game[_0x21de('0x45')][_0x21de('0x49')],'users':Object[_0x21de('0x7b')](game['activity'][_0x21de('0x31')])[_0x21de('0x3b')](_0x19455b=>_0x19455b['active'])[_0x21de('0x7c')],'uptime':game['activity'][_0x21de('0x6e')]});}_0x51d22f['json'](_0x98d2bf);}static async[_0x21de('0x77')](_0x3e6d6c,_0x35d250){const _0x38513e=_0x3e6d6c['session']['admin']||!game['ready']&&!config[_0x21de('0x5e')][_0x21de('0x3d')];if(!_0x38513e){const _0x430152=game[_0x21de('0x5c')]?await db[_0x21de('0x14')][_0x21de('0x4b')]({'_id':_0x3e6d6c['user']}):null;if(!_0x430152||!_0x430152[_0x21de('0x82')](_0x21de('0x34'))){throw new Error(_0x21de('0x15')+options['userId']+_0x21de('0x1e'));}}const _0x4df19d=await Files['upload'](_0x3e6d6c[_0x21de('0x38')][_0x21de('0x21')],_0x3e6d6c['files'][_0x21de('0x81')],_0x3e6d6c[_0x21de('0x38')],{'userId':_0x3e6d6c[_0x21de('0x58')],'isAdmin':_0x3e6d6c[_0x21de('0x5d')][_0x21de('0x3d')]})['catch'](_0x23aaf7=>{return{'error':_0x23aaf7[_0x21de('0x9')]||_0x23aaf7};});return _0x35d250['json'](_0x4df19d);}}module[_0x21de('0x2a')]={'Views':Views};
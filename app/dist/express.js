const _0x2fd0=['license.html','/no','/players','getIPAddresses','vtt\x20game','debug','fatalError','ssl','views','addresses','express-fileupload','ver','webrtc','getOrCreate','public','includes','concat','readFileSync','_staticFiles','header','./views','hbs','address','engine','options','production','Access-Control-Allow-Headers','/node_modules/','express','proxySSL','/stream','worlds','get','no-referrer','root','http','handlebars','mersenne-twister','/scripts','post','license','json','/upload','networkInterfaces','*:*','trust\x20proxy','./common/utils.js','length','/game','sslCert','_userSessionMiddleware','join','hostname','setup','home','./auth','jquery-contextmenu','locals','system-','use','./templates','view\x20engine','needsSignature','_createServer','internal','socket.io','/api/status','Router','quitPost','values','pixi.js','/license','apiStatus','_createApp','sslKey','filter','static','node-fetch','/license.html','handlebars-intl','connection','403\x20Forbidden','Access-Control-Allow-Origin','./webrtc.js','tinymce','DENY','sessions','port','error','templates','listen','socket.io-client','paths','jquery','main','createServer','_middleware','bind','/join','routePrefix','status','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept','X-Frame-Options','_viewDataMiddleware','server','layouts','set','NODE_ENV','activate','://','sendFile','family','redirect','stream','proxyPort','vtt','development','https','world','system','_defineRoutes','local','://localhost:','path','/quit','players','setupPost','filterJoin','reduce','substr','info','hbsHelpers','slice','IPv4','pixi-particles','url','/setup'];(function(_0xcb9d30,_0x2fd0ac){const _0x2827fd=function(_0x3215e2){while(--_0x3215e2){_0xcb9d30['push'](_0xcb9d30['shift']());}};_0x2827fd(++_0x2fd0ac);}(_0x2fd0,0x99));const _0x2827=function(_0xcb9d30,_0x2fd0ac){_0xcb9d30=_0xcb9d30-0x0;let _0x2827fd=_0x2fd0[_0xcb9d30];return _0x2827fd;};const express=require(_0x2827('0xc'));const os=require('os');const fetch=require(_0x2827('0x3d'));const socket=require(_0x2827('0x31'));const exphbs=require('express-handlebars');const fileUpload=require(_0x2827('0x83'));const auth=require(_0x2827('0x27'));const fs=require('fs');const path=require(_0x2827('0x6b'));const {Views}=require(_0x2827('0x4'));const sockets=require('./sockets');const {WebRTCServer}=require(_0x2827('0x43'));const {getRoute}=require(_0x2827('0x1e'));class Express{constructor(_0x27b090,_0x76d5f6){this['paths']=_0x76d5f6;process['env'][_0x2827('0x5b')]=_0x27b090['debug']?_0x2827('0x64'):_0x2827('0x9');this[_0x2827('0x24')]=_0x27b090[_0x2827('0x24')];this[_0x2827('0x53')]=_0x27b090['routePrefix'];this[_0x2827('0x47')]=_0x27b090[_0x2827('0x47')];this['ssl']=_0x27b090['isSSL'];this[_0x2827('0x7e')]=_0x27b090[_0x2827('0x7e')];this['app']=this[_0x2827('0x39')]({'isProxy':_0x27b090[_0x2827('0x62')]||_0x27b090[_0x2827('0xd')]});this['server']=this['_createServer']({'app':this['app'],'isSSL':this[_0x2827('0x80')],'sslKey':_0x27b090[_0x2827('0x3a')],'sslCert':_0x27b090[_0x2827('0x21')]});this['io']=socket(this['server'],{'path':getRoute(_0x2827('0x31'),{'prefix':this[_0x2827('0x53')]}),'origins':_0x2827('0x1c'),'pingInterval':0x4e20,'pingTimeout':0x927c0});this[_0x2827('0x85')]=new WebRTCServer(this,this['server'],_0x27b090);this[_0x2827('0x82')]=null;}get['address'](){let _0x43957f=this['ssl']?_0x2827('0x65'):_0x2827('0x13');let _0x48e7df=_0x43957f+_0x2827('0x6a')+this[_0x2827('0x47')];return _0x48e7df+getRoute('',{'prefix':this[_0x2827('0x53')]});}['_createApp']({isProxy=![]}={}){const _0x2cf159=express();if(isProxy)_0x2cf159[_0x2827('0x5a')](_0x2827('0x1d'),!![]);_0x2cf159[_0x2827('0x5a')](_0x2827('0x81'),path[_0x2827('0x23')](this['paths'][_0x2827('0x12')],_0x2827('0x49'),_0x2827('0x81')));_0x2cf159[_0x2827('0x7')]('hbs',exphbs({'extname':'.hbs','layoutsDir':path[_0x2827('0x23')](this[_0x2827('0x4c')][_0x2827('0x12')],_0x2827('0x49'),_0x2827('0x81'),_0x2827('0x59')),'defaultLayout':_0x2827('0x4e'),'helpers':require(_0x2827('0x2c'))[_0x2827('0x73')]}));_0x2cf159['set'](_0x2827('0x2d'),_0x2827('0x5'));_0x2cf159['use'](express[_0x2827('0x19')]());_0x2cf159[_0x2827('0x2b')](express['urlencoded']({'extended':!![]}));_0x2cf159[_0x2827('0x2b')](fileUpload({}));_0x2cf159[_0x2827('0x2b')](function(_0x2f7196,_0x3f90f1,_0x55be81){if(_0x2f7196['path'][_0x2827('0x71')](-0x1)==='/'&&_0x2f7196[_0x2827('0x6b')][_0x2827('0x1f')]>0x1){let _0x50af1d=_0x2f7196['url'][_0x2827('0x74')](_0x2f7196['path']['length']);_0x3f90f1[_0x2827('0x60')](0x12d,_0x2f7196[_0x2827('0x6b')][_0x2827('0x74')](0x0,-0x1)+_0x50af1d);}else _0x55be81();});const _0x3f5eab=express[_0x2827('0x33')]();_0x2cf159[_0x2827('0x2b')](getRoute('',{'prefix':this[_0x2827('0x53')]}),_0x3f5eab);_0x3f5eab[_0x2827('0x10')](/^\/?$/,Views[_0x2827('0x26')]);this[_0x2827('0x2')](_0x3f5eab);this[_0x2827('0x50')](_0x3f5eab);this[_0x2827('0x68')](_0x3f5eab);return _0x2cf159;}[_0x2827('0x2f')]({app,isSSL,sslKey,sslCert}={}){let _0x2b7bcb;if(isSSL){_0x2b7bcb=require(_0x2827('0x65'))[_0x2827('0x4f')]({'key':fs[_0x2827('0x1')](sslKey),'cert':fs[_0x2827('0x1')](sslCert)},app);}else _0x2b7bcb=require(_0x2827('0x13'))['createServer'](app);return _0x2b7bcb;}[_0x2827('0x50')](_0x4ceaba){_0x4ceaba['use']((_0x52558c,_0x5de02b,_0x2a667a)=>{_0x5de02b['locals']={'bodyClass':_0x2827('0x7d'),'ver':global[_0x2827('0x84')]};if(global[_0x2827('0x7f')])return Views[_0x2827('0x48')](_0x52558c,_0x5de02b,_0x2a667a,global[_0x2827('0x7f')]);_0x2a667a();});_0x4ceaba['use'](this['_viewDataMiddleware'][_0x2827('0x51')](this));_0x4ceaba[_0x2827('0x2b')](this['constructor'][_0x2827('0x22')]);_0x4ceaba[_0x2827('0x2b')](function(_0x1fb1c4,_0x59bd3f,_0xc9a3cd){_0x59bd3f[_0x2827('0x3')](_0x2827('0x42'),'*');_0x59bd3f[_0x2827('0x3')](_0x2827('0xa'),_0x2827('0x55'));_0x59bd3f[_0x2827('0x3')](_0x2827('0x56'),_0x2827('0x45'));_0xc9a3cd();});}static['_userSessionMiddleware'](_0x275788,_0x1b8c7b,_0x3b7208){const {game}=global;const _0x1b5492=auth[_0x2827('0x46')][_0x2827('0x86')](_0x275788,_0x1b8c7b);if(game['ready']){_0x275788['user']=_0x1b5492[_0x2827('0xf')][game[_0x2827('0x66')]['id']]||null;}_0x3b7208();}[_0x2827('0x57')](_0x1b86a2,_0x129d31,_0x14fc62){const {config}=global;const _0x5a9fd9=game&&game['ready']?_0x2827('0x2a')+game[_0x2827('0x67')]['id']:null;_0x129d31[_0x2827('0x29')]={'bodyClass':[_0x2827('0x63'),'game',_0x5a9fd9][_0x2827('0x6f')]('\x20'),'bodyStyle':'','ver':global[_0x2827('0x84')],'eula':!config[_0x2827('0x18')][_0x2827('0x2e')],'addresses':this[_0x2827('0x82')],'routePrefix':this[_0x2827('0x53')]};_0x14fc62();}['_defineRoutes'](_0x221982){_0x221982[_0x2827('0x10')](_0x2827('0x37'),Views[_0x2827('0x18')]);_0x221982[_0x2827('0x17')](_0x2827('0x37'),Views['license']);_0x221982[_0x2827('0x10')](_0x2827('0x78'),Views[_0x2827('0x25')]);_0x221982[_0x2827('0x17')]('/setup',Views[_0x2827('0x6e')]);_0x221982[_0x2827('0x10')](_0x2827('0x7b'),Views[_0x2827('0x6d')]);_0x221982['get'](_0x2827('0x20'),Views['game']);_0x221982['get'](_0x2827('0xe'),Views[_0x2827('0x61')]);_0x221982[_0x2827('0x10')](_0x2827('0x7a'),Views['error']);_0x221982[_0x2827('0x10')](_0x2827('0x52'),Views[_0x2827('0x23')]);_0x221982[_0x2827('0x17')](_0x2827('0x52'),Views['joinPost']);_0x221982[_0x2827('0x17')](_0x2827('0x1a'),Views['uploadFile']);_0x221982[_0x2827('0x17')](_0x2827('0x6c'),Views[_0x2827('0x34')]);_0x221982['get'](_0x2827('0x3e'),(_0x609811,_0x5eaaa0)=>_0x5eaaa0[_0x2827('0x5e')](path[_0x2827('0x23')](this['paths'][_0x2827('0x12')],_0x2827('0x79'))));_0x221982[_0x2827('0x10')](_0x2827('0x32'),Views[_0x2827('0x38')]);}[_0x2827('0x2')](_0x48c866){_0x48c866[_0x2827('0x2b')]((_0x3b84ca,_0x3adf3d,_0x266d39)=>{if(/worlds\/(.*)\.db/['test'](_0x3b84ca[_0x2827('0x77')])){return _0x3adf3d[_0x2827('0x54')](0x193)['end'](_0x2827('0x41'));}_0x266d39();});_0x48c866[_0x2827('0x2b')](express[_0x2827('0x3c')](this[_0x2827('0x4c')][_0x2827('0x87')]));_0x48c866[_0x2827('0x2b')](express[_0x2827('0x3c')](this[_0x2827('0x4c')]['data'],{'redirect':![]}));const _0x317373=[_0x2827('0x4d'),_0x2827('0x28'),_0x2827('0x14'),_0x2827('0x3f'),'howler',_0x2827('0x36'),_0x2827('0x76'),_0x2827('0x4b'),_0x2827('0x15')];for(let _0x551388 of _0x317373){_0x48c866[_0x2827('0x2b')](_0x2827('0x16'),express['static'](this[_0x2827('0x4c')][_0x2827('0x12')]+(_0x2827('0xb')+_0x551388+'/dist/')));}const _0x179d2f=[_0x2827('0x44')];for(let _0x3cfd71 of _0x179d2f){_0x48c866['use'](_0x2827('0x16'),express['static'](this[_0x2827('0x4c')]['root']+(_0x2827('0xb')+_0x3cfd71+'/')));}}async[_0x2827('0x4a')](_0x984c27){_0x984c27=_0x984c27||this['port'];const {logger}=config;this['addresses']=await this[_0x2827('0x7c')]();return new Promise((_0x3e94b8,_0x462278)=>{this[_0x2827('0x58')][_0x2827('0x4a')](_0x984c27,()=>{this['io']['on'](_0x2827('0x40'),sockets[_0x2827('0x5c')]);logger[_0x2827('0x72')]('Server\x20started\x20and\x20listening\x20on\x20port\x20'+this[_0x2827('0x58')][_0x2827('0x6')]()[_0x2827('0x47')]);_0x3e94b8(this);})['on'](_0x2827('0x48'),_0x462278);});}async['getIPAddresses'](){const _0x3304fe=Object[_0x2827('0x35')](os[_0x2827('0x1b')]());let _0x157f89=_0x3304fe[_0x2827('0x70')]((_0x8c57e8,_0x52c48f)=>{return _0x8c57e8[_0x2827('0x0')](_0x52c48f[_0x2827('0x3b')](_0x476a3a=>_0x476a3a[_0x2827('0x5f')]===_0x2827('0x75')&&!_0x476a3a[_0x2827('0x30')]));},[]);_0x157f89=_0x157f89[_0x2827('0x1f')]?_0x157f89[0x0][_0x2827('0x6')]:null;let _0x475bab=null;try{let _0x2b935b=await fetch('http://api.ipify.org/?format=json',{'referrerPolicy':_0x2827('0x11')});let _0x3ba128=await _0x2b935b[_0x2827('0x19')]();_0x475bab=_0x3ba128['ip'];}catch(_0x5f5058){}return{'local':_0x157f89,'external':_0x475bab,'remote':this[_0x2827('0x24')]||_0x475bab};}['getInvitationLinks'](){const _0xd4cba0=config[_0x2827('0x8')];const _0x2dcf47=this['ssl']||_0xd4cba0[_0x2827('0xd')]?'https':_0x2827('0x13');const _0x3b6bcd=Number['isFinite'](_0xd4cba0[_0x2827('0x62')])?_0xd4cba0[_0x2827('0x62')]:this[_0x2827('0x47')];const _0x35b918={};for(let _0x221547 of[_0x2827('0x69'),'remote']){let _0xae25f0=_0x2dcf47+_0x2827('0x5d')+this[_0x2827('0x82')][_0x221547];if(![0x50,0x1bb][_0x2827('0x88')](_0x3b6bcd))_0xae25f0+=':'+_0x3b6bcd;_0x35b918[_0x221547]=_0xae25f0+getRoute('',{'prefix':this[_0x2827('0x53')]});}return _0x35b918;}}module['exports']={'Express':Express};
const _0x5b80=['admin','options','./packages/module','handleEvent','user','world','./database/odm/embedded','query','find','server','default','__importDefault','userOptions','./database/entities/scene','exports','files','ready','socketListeners','./common/constants','getDefaultLanguageOptions','activate','clientConfig','./database/entities/playlist','./database/odm/document','emit','error','__esModule','./auth','\x20for\x20event\x20','broadcast','getPackages','./packages/world','_id','data','./database/documents/compendium','config','message','./errors','getWorldStatus','users','userId','ver','sessions'];(function(_0x54ef4a,_0x5b80e4){const _0xa3d500=function(_0x4254c2){while(--_0x4254c2){_0x54ef4a['push'](_0x54ef4a['shift']());}};_0xa3d500(++_0x5b80e4);}(_0x5b80,0x1c9));const _0xa3d5=function(_0x54ef4a,_0x5b80e4){_0x54ef4a=_0x54ef4a-0x0;let _0xa3d500=_0x5b80[_0x54ef4a];return _0xa3d500;};'use strict';var __importDefault=this&&this[_0xa3d5('0x1b')]||function(_0x372e30){return _0x372e30&&_0x372e30[_0xa3d5('0x2a')]?_0x372e30:{'default':_0x372e30};};Object['defineProperty'](exports,'__esModule',{'value':!![]});exports['activate']=exports['handleEvent']=void 0x0;const {PASSWORD_SAFE_STRING}=require(_0xa3d5('0x22'));const auth=require(_0xa3d5('0x0'));const {Activity}=require('./modules/activity');const {System}=require('./packages/system');const {Module}=require(_0xa3d5('0x12'));const {World}=require(_0xa3d5('0x4'));const {JournalEntry}=require('./database/entities/journal');const {Scene}=require(_0xa3d5('0x1d'));const {Playlist}=require(_0xa3d5('0x26'));const compendium_1=__importDefault(require(_0xa3d5('0x7')));const document_1=__importDefault(require(_0xa3d5('0x27')));const embedded_1=__importDefault(require(_0xa3d5('0x16')));const files_1=__importDefault(require('./files/files'));const errors_1=__importDefault(require(_0xa3d5('0xa')));async function handleEvent(_0x4caac4,_0x4df18d,_0x491b0f,_0x36d24f){const _0x53487c=this['user'];if(!_0x53487c){throw new Error('Unrecognized\x20User\x20attacked\x20to\x20socket\x20'+this['id']+_0xa3d5('0x1')+_0x4caac4);}_0x491b0f['options']=_0x491b0f[_0xa3d5('0x11')]||{};let _0x5b1bcf={'userId':_0x53487c[_0xa3d5('0x5')]?_0x53487c['_id']:undefined,'request':_0x491b0f};try{_0x5b1bcf['result']=await _0x4df18d(_0x53487c,_0x491b0f);}catch(_0x52582a){_0x52582a=new errors_1[(_0xa3d5('0x1a'))](_0x52582a[_0xa3d5('0x9')],_0x52582a['stack']);logger['error'](_0x52582a);_0x5b1bcf[_0xa3d5('0x29')]=_0x52582a;}const _0xb40cbd='broadcast'in _0x491b0f[_0xa3d5('0x11')]?_0x491b0f[_0xa3d5('0x11')][_0xa3d5('0x2')]:!![];if(_0x36d24f){_0x36d24f(_0x5b1bcf);if(_0xb40cbd)this[_0xa3d5('0x2')]['emit'](_0x4caac4,_0x5b1bcf);}else if(_0xb40cbd)this[_0xa3d5('0x19')][_0xa3d5('0x28')](_0x4caac4,_0x5b1bcf);return _0x5b1bcf;}exports[_0xa3d5('0x13')]=handleEvent;async function activate(_0x1cf524){const _0x163337=_0x1cf524['handshake'][_0xa3d5('0x17')];const _0x22bcc4=auth[_0xa3d5('0xf')][_0xa3d5('0xf')][_0x163337['session']];if(!_0x22bcc4)return;_0x1cf524['session']=_0x22bcc4;_0x1cf524['on'](_0xa3d5('0xb'),requestWorldState);_0x1cf524['on']('getSetupData',_0x3403cd=>requestSetupData(_0x22bcc4,_0x3403cd));files_1[_0xa3d5('0x1a')][_0xa3d5('0x21')](_0x1cf524,handleEvent);if(!game['world']||!game[_0xa3d5('0x20')])return;const _0x59346b=_0x22bcc4['worlds'][game[_0xa3d5('0x15')]['id']];const _0x581fd7=game[_0xa3d5('0xc')][_0xa3d5('0x18')](_0x32209f=>_0x32209f[_0xa3d5('0x5')]===_0x59346b);if(!_0x581fd7)return;_0x1cf524[_0xa3d5('0xd')]=_0x59346b;_0x1cf524[_0xa3d5('0x14')]=_0x581fd7;Activity[_0xa3d5('0x21')](_0x1cf524);document_1[_0xa3d5('0x1a')]['socketListeners'](_0x1cf524,handleEvent);embedded_1[_0xa3d5('0x1a')][_0xa3d5('0x21')](_0x1cf524,handleEvent);compendium_1['default']['socketListeners'](_0x1cf524,handleEvent);Scene[_0xa3d5('0x21')](_0x1cf524,handleEvent);JournalEntry[_0xa3d5('0x21')](_0x1cf524,handleEvent);Playlist[_0xa3d5('0x21')](_0x1cf524,handleEvent);System[_0xa3d5('0x21')](_0x1cf524);Module[_0xa3d5('0x21')](_0x1cf524);World[_0xa3d5('0x21')](_0x1cf524);}exports[_0xa3d5('0x24')]=activate;function requestWorldState(_0x1fe15e){return _0x1fe15e(game['world']&&game[_0xa3d5('0x20')]);}async function requestSetupData(_0x3495b6,_0x3e1add){const _0x2cd878=global[_0xa3d5('0x8')];const _0x1c6902={'version':_0x2cd878[_0xa3d5('0xe')],'systems':System[_0xa3d5('0x3')](),'modules':Module['getPackages'](),'adminKey':_0x2cd878['adminKey']?PASSWORD_SAFE_STRING:'','isSetup':!![],'isAdmin':_0x3495b6[_0xa3d5('0x10')],'options':_0x2cd878[_0xa3d5('0x1c')],'files':_0x2cd878[_0xa3d5('0x1f')][_0xa3d5('0x25')],'languages':Module[_0xa3d5('0x23')](),'worlds':World[_0xa3d5('0x3')](),'world':game['world']?game[_0xa3d5('0x15')][_0xa3d5('0x6')]:null,'coreUpdate':await _0x2cd878['updater']['getUpdateNotification']()};return _0x3e1add(_0x1c6902);}module[_0xa3d5('0x1e')]={'activate':activate,'handleEvent':handleEvent};
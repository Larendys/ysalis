const _0x1b81=['default','defineProperty','../../common/utils','push','isEmbeddedCollection','getData','bind','\x20with\x20ids:\x20[','You\x20cannot\x20access\x20the\x20','broadcast','_onCreate','deleteOne','_getTable','length','isEmbeddedDocument','The\x20','datastores','get','_changed','update','data','active','preSave','delete','constructor','schema','\x20documents','filename','_onGet','validate','deleteAll','\x20lacks\x20permission\x20to\x20create\x20a\x20new\x20','all','type','Deleted\x20','\x20table','info','name','disconnect','updateOne','findOne','You\x20cannot\x20update\x20a\x20','values','User\x20','isGM','canUpdate','__esModule','_onUpdate','world','set','\x20lacks\x20permission\x20to\x20delete\x20all\x20','\x20lacks\x20permission\x20to\x20delete\x20','Invalid\x20database\x20action\x20','keys','exports','from','ASSISTANT','.db','\x20lacks\x20permission\x20to\x20update\x20','postSave','isPrimaryDocument','connected','findMany','connect','filter','isValidId','create','modifyDocument','./datastore','canCreate','./abstract','expandObject','Created\x20','collection','metadata','_id','hasRole','\x20provided\x20for\x20Database\x20operation','canDelete','postDelete','path','./validators','has','__importDefault','\x20requested\x20on\x20the\x20','save','\x20without\x20providing\x20an\x20_id','find','map'];(function(_0x3318d,_0x1b8138){const _0x10dfeb=function(_0x2602a3){while(--_0x2602a3){_0x3318d['push'](_0x3318d['shift']());}};_0x10dfeb(++_0x1b8138);}(_0x1b81,0x64));const _0x10df=function(_0x3318d,_0x1b8138){_0x3318d=_0x3318d-0x0;let _0x10dfeb=_0x1b81[_0x3318d];return _0x10dfeb;};'use strict';var __importDefault=this&&this[_0x10df('0x48')]||function(_0x1c0d2b){return _0x1c0d2b&&_0x1c0d2b[_0x10df('0x23')]?_0x1c0d2b:{'default':_0x1c0d2b};};Object[_0x10df('0x4f')](exports,_0x10df('0x23'),{'value':!![]});const path=require(_0x10df('0x45'));const util=require(_0x10df('0x50'));const validators_1=__importDefault(require(_0x10df('0x46')));const datastore_1=require(_0x10df('0x39'));const abstract_1=__importDefault(require(_0x10df('0x3b')));class Document extends abstract_1[_0x10df('0x4e')]{static get['schema'](){return{'_id':{'type':String,'required':!![],'default':null,'validate':validators_1['default'][_0x10df('0x36')]}};}static get[_0x10df('0x3f')](){const _0x5c512a=super[_0x10df('0x3f')];_0x5c512a[_0x10df('0x31')]=!![];return _0x5c512a;}[_0x10df('0x52')](_0x421978){const _0xff53e1=this[_0x10df('0xe')][_0x421978];if(_0xff53e1&&_0xff53e1['type']instanceof Array){let _0x5f00d0=_0xff53e1[_0x10df('0x16')][0x0];if(_0x5f00d0[_0x10df('0x3f')]&&_0x5f00d0['metadata'][_0x10df('0x3')])return!![];}return![];}static[_0x10df('0x3a')](_0xab1e6,_0x5965e6){return _0xab1e6[_0x10df('0x41')]('ASSISTANT');}static[_0x10df('0x22')](_0x133183,_0x5b632f,_0x162654){return _0x133183[_0x10df('0x41')](_0x10df('0x2d'));}static[_0x10df('0x43')](_0x2e5199,_0x3457ae){return _0x2e5199[_0x10df('0x41')]('ASSISTANT');}static get[_0x10df('0x32')](){return datastore_1[_0x10df('0x5')][_0x10df('0x47')](this[_0x10df('0x3e')]);}static[_0x10df('0x34')](){return datastore_1['NeDBDatastore'][_0x10df('0x34')](this[_0x10df('0x3e')],this[_0x10df('0x10')]);}static[_0x10df('0x1b')](){const _0x2b88f5=this['ds'];if(_0x2b88f5&&_0x2b88f5['connected'])_0x2b88f5['disconnect']();}static get['db'](){const _0x4cdd18=this['ds'];if(!_0x4cdd18||!_0x4cdd18['connected'])throw new Error(_0x10df('0x4')+this['collection']+'\x20datastore\x20is\x20not\x20yet\x20connected!');return _0x4cdd18;}get['db'](){return this[_0x10df('0xd')]['db'];}static get['ds'](){if(!game[_0x10df('0xa')])throw new Error(_0x10df('0x56')+this[_0x10df('0x3e')]+'\x20datastore\x20before\x20the\x20game\x20is\x20ready!');return datastore_1['datastores'][_0x10df('0x6')](this[_0x10df('0x3e')]);}static get[_0x10df('0x10')](){return path['join'](game[_0x10df('0x25')][_0x10df('0x45')],_0x10df('0x9'),this[_0x10df('0x3e')]+_0x10df('0x2e'));}static['create'](_0x112a3c,_0x3e535f){_0x112a3c=util[_0x10df('0x3c')](_0x112a3c);const _0x285576=new this(_0x112a3c);delete _0x285576['_id'];return _0x285576;}async[_0x10df('0xc')](){await this['db'][_0x10df('0x0')]({'_id':this[_0x10df('0x40')]});return this[_0x10df('0x40')];}static async['findOne'](_0x398f03={}){const _0x2af7f4=await this['db'][_0x10df('0x1d')](_0x398f03);if(_0x2af7f4===null)return null;return new this(_0x2af7f4);}static async[_0x10df('0x4c')](_0x4b87a7={},_0x1d3e54={}){let _0x2e0f6b=await this['db'][_0x10df('0x33')](_0x4b87a7,_0x1d3e54);return _0x2e0f6b[_0x10df('0x4d')](_0x200879=>new this(_0x200879));}async[_0x10df('0x4a')](_0x5eaf6a={}){await this[_0x10df('0xb')](_0x5eaf6a);const _0x5929be=Object[_0x10df('0x2a')](this[_0x10df('0x7')]||{})[_0x10df('0x35')](_0x507f2c=>this[_0x10df('0x52')](_0x507f2c));for(let _0x533fbd of _0x5929be){await Promise['all'](this[_0x533fbd][_0x10df('0x4d')](_0x3ed13a=>_0x3ed13a[_0x10df('0xb')](_0x5eaf6a)));}this[_0x10df('0x12')]();const _0xc13348=this[_0x10df('0x53')]();if(!_0xc13348['_id']){delete _0xc13348['_id'];const _0x2963e4=await this['db']['insertOne'](_0xc13348);this[_0x10df('0x40')]=_0x2963e4['_id'];}else{await this['db'][_0x10df('0x1c')]({'_id':_0xc13348[_0x10df('0x40')]},_0xc13348);}await this[_0x10df('0x30')](_0x5eaf6a);for(let _0x5a238f of _0x5929be){await Promise[_0x10df('0x15')](this[_0x5a238f][_0x10df('0x4d')](_0x2caa01=>_0x2caa01[_0x10df('0x30')](_0x5eaf6a)));}return this;}async['preSave'](_0x27cc2b){}async[_0x10df('0x30')](_0x5b5e4c){}async[_0x10df('0x44')](_0x32cd71){}static['socketListeners'](_0x17a75f,_0x2ed7e5){_0x17a75f['on'](_0x10df('0x38'),_0x2ed7e5['bind'](_0x17a75f,_0x10df('0x38'),this['_onModifyDocument'][_0x10df('0x54')](this)));}static async['_onModifyDocument'](_0x50b7d8,{action,type,data,options}){const _0x19c38b=await this[_0x10df('0x1')](type);switch(action){case'get':return _0x19c38b[_0x10df('0x11')](_0x50b7d8,data,options);case'create':return _0x19c38b['_onCreate'](_0x50b7d8,data,options);case _0x10df('0x8'):return _0x19c38b[_0x10df('0x24')](_0x50b7d8,data,options);case _0x10df('0xc'):return _0x19c38b['_onDelete'](_0x50b7d8,data,options);default:throw new Error(_0x10df('0x29')+action+_0x10df('0x49')+type+_0x10df('0x18'));}}static async['_getTable'](_0x2c40cd){if(!_0x2c40cd||!(_0x2c40cd in db)){throw new Error('Invalid\x20document\x20type\x20'+_0x2c40cd+_0x10df('0x42'));}return db[_0x2c40cd];}static async[_0x10df('0x11')](_0x26916c,_0x3a73e4,_0x4d3cd6){_0x4d3cd6[_0x10df('0x57')]=![];return await this[_0x10df('0x4c')](_0x3a73e4);}static async[_0x10df('0x58')](_0x31927d,_0x58bfd0,_0x3cce7e){_0x58bfd0=_0x58bfd0 instanceof Array?_0x58bfd0:[_0x58bfd0];let _0x3a6757=[];for(let _0x590160 of _0x58bfd0){delete _0x590160[_0x10df('0x40')];const _0x41b015=this[_0x10df('0x37')](_0x590160,_0x31927d);let _0xe891ee=await this[_0x10df('0x3a')](_0x31927d,_0x41b015);if(!_0xe891ee)throw new Error(_0x10df('0x20')+_0x31927d['name']+_0x10df('0x14')+this[_0x10df('0x1a')]);_0x3a6757[_0x10df('0x51')](_0x41b015);}if(!_0x3cce7e['temporary']){for(let _0x785d07 of _0x3a6757){await _0x785d07[_0x10df('0x4a')](_0x3cce7e);}let _0x13454c=_0x3a6757[_0x10df('0x2')]===0x1?'Created\x20'+this['name']:_0x10df('0x3d')+_0x3a6757[_0x10df('0x2')]+'\x20'+this['name']+'s';if(_0x3a6757[_0x10df('0x2')]===0x1)_0x13454c+='\x20with\x20id\x20'+_0x3a6757[0x0]['_id'];else if(_0x3a6757[_0x10df('0x2')]<=0x5)_0x13454c+='\x20with\x20ids:\x20['+_0x3a6757[_0x10df('0x4d')](_0x3556dc=>_0x3556dc[_0x10df('0x40')])+']';logger[_0x10df('0x19')](_0x13454c);}else _0x3cce7e['broadcast']=![];return _0x3a6757;}static async[_0x10df('0x24')](_0xca0e6e,_0xc9a960,_0x3cac4d){const _0x53323e=new Map();for(let _0x2584a1 of _0xc9a960 instanceof Array?_0xc9a960:[_0xc9a960]){if(!('_id'in _0x2584a1))throw new Error(_0x10df('0x1e')+this[_0x10df('0x1a')]+_0x10df('0x4b'));_0x53323e[_0x10df('0x26')](_0x2584a1[_0x10df('0x40')],_0x2584a1);}const _0x11a3fc=await this[_0x10df('0x4c')]({'_id':{'$in':Array['from'](_0x53323e[_0x10df('0x2a')]())}});for(let _0x3ecede of _0x11a3fc){const _0x51d6f=_0x53323e[_0x10df('0x6')](_0x3ecede['_id']);let _0x4aafc6=await this[_0x10df('0x22')](_0xca0e6e,_0x3ecede,_0x51d6f);if(!_0x4aafc6)throw new Error(_0x10df('0x20')+_0xca0e6e['name']+_0x10df('0x2f')+this[_0x10df('0x1a')]+'\x20'+_0x3ecede[_0x10df('0x40')]);_0x3ecede['update'](_0x51d6f,_0x3cac4d);await _0x3ecede['save'](_0x3cac4d);_0x53323e['set'](_0x3ecede[_0x10df('0x40')],util['filterObject'](_0x51d6f,_0x3ecede,{'keepSpecial':!![],'templateValues':!![]}));}return Array[_0x10df('0x2c')](_0x53323e[_0x10df('0x1f')]());}static async['_onDelete'](_0x51905e,_0xbb7e71,_0x80f6b8){_0xbb7e71=_0xbb7e71 instanceof Array?_0xbb7e71:[_0xbb7e71];if(_0x80f6b8['deleteAll']){if(!_0x51905e[_0x10df('0x21')]){throw new Error(_0x10df('0x20')+_0x51905e[_0x10df('0x1a')]+_0x10df('0x27')+this[_0x10df('0x1a')]+_0x10df('0xf'));}}let _0x9bddb8=_0x80f6b8['deleteAll']?{}:{'_id':{'$in':_0xbb7e71}};const _0x20d172=await this[_0x10df('0x4c')](_0x9bddb8);if(!_0x80f6b8[_0x10df('0x13')]){for(let _0x127bd5 of _0x20d172){let _0x4c1c70=await this[_0x10df('0x43')](_0x51905e,_0x127bd5);if(!_0x4c1c70)throw new Error('User\x20'+_0x51905e[_0x10df('0x1a')]+_0x10df('0x28')+this[_0x10df('0x1a')]+'\x20'+_0x127bd5[_0x10df('0x40')]);}}await this['db']['deleteMany'](_0x9bddb8);for(let _0x3561c7 of _0x20d172){await _0x3561c7[_0x10df('0x44')](_0x80f6b8);}let _0x4286e5=_0xbb7e71[_0x10df('0x2')]===0x1?_0x10df('0x17')+this[_0x10df('0x1a')]:_0x10df('0x17')+(_0x80f6b8['deleteAll']?_0x10df('0x15'):_0xbb7e71[_0x10df('0x2')])+'\x20'+this[_0x10df('0x1a')]+'s';if(_0xbb7e71[_0x10df('0x2')]===0x1)_0x4286e5+='\x20with\x20id\x20'+_0xbb7e71[0x0];else if(!_0x80f6b8[_0x10df('0x13')]&&_0xbb7e71['length']<=0x5)_0x4286e5+=_0x10df('0x55')+_0xbb7e71+']';logger[_0x10df('0x19')](_0x4286e5);return _0xbb7e71;}}exports[_0x10df('0x4e')]=Document;module[_0x10df('0x2b')]=Document;
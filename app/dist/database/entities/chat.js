const _0x3e9b=['./user','../../common/constants','../../common/utils','now','length','sort','some','test','token','hasOwnProperty','preSave','../odm/entity','isJSON','emote','alias','canUpdate','isGM','sound','speaker','schema','chat','content','metadata','permission','timestamp','roll','user','actor','Invalid\x20ChatMessage\x20type\x20provided','_changed','blind','folder','OTHER','Actor','scene','whisper','includes','_id','flavor'];(function(_0x101ce9,_0x3e9b5e){const _0x4be27f=function(_0x52b9fa){while(--_0x52b9fa){_0x101ce9['push'](_0x101ce9['shift']());}};_0x4be27f(++_0x3e9b5e);}(_0x3e9b,0xa7));const _0x4be2=function(_0x101ce9,_0x3e9b5e){_0x101ce9=_0x101ce9-0x0;let _0x4be27f=_0x3e9b[_0x101ce9];return _0x4be27f;};const AbstractBaseDocument=require('../odm/abstract');const Entity=require(_0x4be2('0x0'));const Validators=require('../odm/validators');const util=require(_0x4be2('0x1e'));const User=require(_0x4be2('0x1c'));const {CHAT_MESSAGE_TYPES}=require(_0x4be2('0x1d'));class Speaker extends AbstractBaseDocument{static get[_0x4be2('0x8')](){const _0xc85ef7=global['db'];const _0x1b41fa={};_0x1b41fa[_0x4be2('0x17')]={'type':_0xc85ef7['Scene'],'required':![]};_0x1b41fa[_0x4be2('0x10')]={'type':_0xc85ef7[_0x4be2('0x16')],'required':![]};_0x1b41fa[_0x4be2('0x24')]={'type':String,'required':![]};_0x1b41fa[_0x4be2('0x3')]={'type':String,'required':![]};return _0x1b41fa;}}class ChatMessage extends Entity{static get[_0x4be2('0x8')](){const _0x6b479b=super[_0x4be2('0x8')];delete _0x6b479b['name'];delete _0x6b479b[_0x4be2('0x21')];delete _0x6b479b[_0x4be2('0x14')];delete _0x6b479b[_0x4be2('0xc')];_0x6b479b['type']={'type':Number,'required':!![],'default':CHAT_MESSAGE_TYPES[_0x4be2('0x15')],'validate':_0x1c35f9=>Object['values'](CHAT_MESSAGE_TYPES)[_0x4be2('0x19')](_0x1c35f9),'validationError':_0x4be2('0x11')};_0x6b479b[_0x4be2('0xf')]={'type':User,'required':!![]};_0x6b479b[_0x4be2('0xd')]={'type':Date,'required':!![],'default':Date[_0x4be2('0x1f')]};_0x6b479b[_0x4be2('0x1b')]={'type':String,'required':![],'validate':_0x3d9e22=>_0x3d9e22[_0x4be2('0x20')]>0x0&&!/<script>/[_0x4be2('0x23')](_0x3d9e22)};_0x6b479b[_0x4be2('0xa')]={'type':String,'required':!![],'validate':_0x1cad09=>_0x1cad09['length']>0x0&&!/<script>/[_0x4be2('0x23')](_0x1cad09)};_0x6b479b[_0x4be2('0x7')]={'type':Speaker,'required':!![],'default':{}};_0x6b479b[_0x4be2('0x18')]={'type':[User],'required':!![],'default':[]};_0x6b479b[_0x4be2('0xe')]={'type':String,'required':![],'validate':Validators[_0x4be2('0x1')],'validationError':'The\x20provided\x20Roll\x20data\x20is\x20not\x20valid\x20JSON.'};_0x6b479b[_0x4be2('0x6')]={'type':String,'required':![]};_0x6b479b[_0x4be2('0x13')]={'type':Boolean,'required':![]};_0x6b479b[_0x4be2('0x2')]={'type':Boolean,'required':![]};return _0x6b479b;}static get[_0x4be2('0xb')](){return util['mergeObject'](super[_0x4be2('0xb')],{'collection':_0x4be2('0x9')});}async[_0x4be2('0x26')](_0x35424a){if(!this['_changed']||this[_0x4be2('0x12')][_0x4be2('0x25')](_0x4be2('0xa'))){if(this[_0x4be2('0xa')])this[_0x4be2('0xa')]=Validators['cleanHTML'](this[_0x4be2('0xa')]);}if(!this[_0x4be2('0x12')]||this[_0x4be2('0x12')]['hasOwnProperty'](_0x4be2('0x1b'))){if(this[_0x4be2('0x1b')])this[_0x4be2('0x1b')]=Validators['cleanHTML'](this[_0x4be2('0x1b')]);}}static['canCreate'](_0x279e0d,_0xe79139){if(_0x279e0d[_0x4be2('0x5')])return!![];if(_0xe79139[_0x4be2('0xf')]!==_0x279e0d[_0x4be2('0x1a')])return![];return _0x279e0d['hasRole']('PLAYER');}static[_0x4be2('0x4')](_0x542666,_0x4b3dd7,_0x20ca6e){if(_0x542666[_0x4be2('0x5')])return!![];const _0xfb878c=['user',_0x4be2('0xe')];if(_0xfb878c[_0x4be2('0x22')](_0x505cae=>_0x20ca6e['hasOwnProperty'](_0x505cae)))return![];return _0x542666[_0x4be2('0x1a')]===_0x4b3dd7['user'];}static['canDelete'](_0x13e76b,_0x2e9428){if(_0x13e76b[_0x4be2('0x5')])return!![];return _0x13e76b[_0x4be2('0x1a')]===_0x2e9428['user'];}}module['exports']={'ChatMessage':ChatMessage};
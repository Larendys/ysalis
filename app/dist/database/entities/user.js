const _0x383f=['../../auth','GAMEMASTER','User\x20color\x20must\x20be\x20a\x20valid\x20CSS\x20color\x20string.','deactivateUserSession','hotbar','activity','isRole','hasImageExtension','../odm/entity','random','schema','getUsers','ready','./actor','permissions','__importDefault','filter','canUpdate','role','isColorString','_validateHotbar','_changed','sort','\x20is\x20already\x20taken','keys','get','toString','PLAYER','../../const','viewedScene','character','Invalid\x20User\x20permission\x20name\x20or\x20value\x20assigned.','../odm/validators','color','ASSISTANT','includes','USER_ROLES','password','preSave','avatar','hasPermission','has','userId','../../common/utils','every','_id','hasRole','defineProperty','values','users','isActive','__esModule','find','User\x20names\x20must\x20be\x20unique,\x20the\x20name\x20','entries','some','isGM','object','name','localeCompare','string','sockets','active','default'];(function(_0x5b3bfe,_0x383fc5){const _0x1fc53e=function(_0x46af0b){while(--_0x46af0b){_0x5b3bfe['push'](_0x5b3bfe['shift']());}};_0x1fc53e(++_0x383fc5);}(_0x383f,0x1e3));const _0x1fc5=function(_0x5b3bfe,_0x383fc5){_0x5b3bfe=_0x5b3bfe-0x0;let _0x1fc53e=_0x383f[_0x5b3bfe];return _0x1fc53e;};'use strict';var __importDefault=this&&this[_0x1fc5('0x2c')]||function(_0x135ba6){return _0x135ba6&&_0x135ba6[_0x1fc5('0x10')]?_0x135ba6:{'default':_0x135ba6};};Object[_0x1fc5('0xc')](exports,'__esModule',{'value':!![]});const {hsvToRgb,rgbToHex}=require(_0x1fc5('0x8'));const {sessions}=require(_0x1fc5('0x1d'));const entity_1=__importDefault(require(_0x1fc5('0x25')));const const_1=require(_0x1fc5('0x39'));const validators_1=__importDefault(require(_0x1fc5('0x3d')));class User extends entity_1[_0x1fc5('0x1c')]{static get[_0x1fc5('0x27')](){const _0x145018=super[_0x1fc5('0x27')];delete _0x145018['folder'];delete _0x145018['permission'];_0x145018[_0x1fc5('0x2f')]={'type':Number,'required':!![],'default':const_1['USER_ROLES'][_0x1fc5('0x38')]};_0x145018[_0x1fc5('0x2b')]={'type':Object,'required':!![],'default':{},'validate':_0x3c9298=>Object[_0x1fc5('0x13')](_0x3c9298)[_0x1fc5('0x9')](_0x3754fe=>{return typeof _0x3754fe[0x0]===_0x1fc5('0x19')&&typeof _0x3754fe[0x1]==='boolean';}),'validationError':_0x1fc5('0x3c')};_0x145018[_0x1fc5('0x2')]={'type':String,'required':![]};_0x145018[_0x1fc5('0x4')]={'type':String,'required':![],'validate':_0x3cf643=>validators_1['default'][_0x1fc5('0x24')](_0x3cf643),'validationError':'The\x20provided\x20media\x20file\x20does\x20not\x20have\x20a\x20valid\x20image\x20file\x20extension.'};_0x145018[_0x1fc5('0x3b')]={'type':Actor,'required':![]};_0x145018[_0x1fc5('0x3e')]={'type':String,'required':!![],'default':()=>'#'+rgbToHex(hsvToRgb(Math[_0x1fc5('0x26')](),0.8,0.8))[_0x1fc5('0x37')](0x10),'validate':validators_1['default'][_0x1fc5('0x30')],'validationError':_0x1fc5('0x1f')};_0x145018[_0x1fc5('0x21')]={'type':Object,'required':!![],'default':{},'validate':this[_0x1fc5('0x31')],'validationError':'Invalid\x20Hotbar\x20object\x20structure\x20for\x20User'};return _0x145018;}static['_validateHotbar'](_0x2f98e8){if(typeof _0x2f98e8!==_0x1fc5('0x16'))return![];for(let [_0x270e52,_0x4f9d48]of Object['entries'](_0x2f98e8)){let _0x2d90fc=parseInt(_0x270e52);if(!_0x2d90fc||_0x2d90fc<0x1||_0x2d90fc>0x32)return![];if(!validators_1[_0x1fc5('0x1c')]['isValidId'](_0x4f9d48))return![];}return!![];}static['create'](_0x7a471f,_0x36b773){const _0x160e6f=new this(_0x7a471f);delete _0x160e6f[_0x1fc5('0xa')];return _0x160e6f;}[_0x1fc5('0xb')](_0x1cfd5e){const _0x282113=typeof _0x1cfd5e===_0x1fc5('0x19')?const_1[_0x1fc5('0x1')][_0x1cfd5e]:_0x1cfd5e;return _0x282113!==undefined&&this[_0x1fc5('0x2f')]>=_0x282113;}[_0x1fc5('0x23')](_0x37c518){const _0x5eb451=typeof _0x37c518===_0x1fc5('0x19')?const_1[_0x1fc5('0x1')][_0x37c518]:_0x37c518;return _0x5eb451!==undefined&&this[_0x1fc5('0x2f')]===_0x5eb451;}[_0x1fc5('0x5')](_0x1e0e72){if(!game[_0x1fc5('0x29')])return![];if(this['isGM'])return!![];if(_0x1e0e72 in this['permissions'])return this[_0x1fc5('0x2b')][_0x1e0e72];const _0x227ee9=game[_0x1fc5('0x2b')][_0x1e0e72];return _0x227ee9?_0x227ee9[_0x1fc5('0x0')](this[_0x1fc5('0x2f')]):![];}get[_0x1fc5('0x15')](){return this['isRole'](_0x1fc5('0x1e'));}get['session'](){return sessions[_0x1fc5('0x36')]();}get['sockets'](){return Object[_0x1fc5('0xd')](config[_0x1fc5('0x1a')])[_0x1fc5('0x2d')](_0x5ddff2=>{if(!_0x5ddff2['user'])return![];return _0x5ddff2[_0x1fc5('0x7')]===this['_id'];});}get[_0x1fc5('0xf')](){if(!this[_0x1fc5('0xa')])return![];return game[_0x1fc5('0x1b')]&&game['activity']&&this[_0x1fc5('0xa')]in game[_0x1fc5('0x22')]['users'];}static['canCreate'](_0x52e51a,_0x51e929){return _0x52e51a[_0x1fc5('0x2f')]===const_1[_0x1fc5('0x1')][_0x1fc5('0x1e')];}static[_0x1fc5('0x2e')](_0x2a3d1c,_0x5b7ad0,_0x48a821){if(_0x2a3d1c[_0x1fc5('0x2f')]===const_1[_0x1fc5('0x1')][_0x1fc5('0x1e')])return!![];let _0x25c19c=new Set(Object[_0x1fc5('0x35')](_0x48a821));if([_0x1fc5('0x17'),_0x1fc5('0x2f'),_0x1fc5('0x2')][_0x1fc5('0x14')](_0x16419f=>_0x25c19c[_0x1fc5('0x6')](_0x16419f)))return![];return _0x2a3d1c[_0x1fc5('0xa')]===_0x5b7ad0['_id'];}static['canDelete'](_0x54439f,_0x248b47){return _0x54439f[_0x1fc5('0x2f')]===const_1[_0x1fc5('0x1')]['GAMEMASTER'];}async[_0x1fc5('0x3')](_0x5c2d0d={}){const _0xcbae19=this[_0x1fc5('0x32')]||{};if(_0x1fc5('0x17')in _0xcbae19){const _0x35e699=await User['find']({'name':this[_0x1fc5('0x17')]});if(_0x35e699[_0x1fc5('0x11')](_0x57b2a6=>_0x57b2a6[_0x1fc5('0xa')]!==this[_0x1fc5('0xa')])){throw Error(_0x1fc5('0x12')+this[_0x1fc5('0x17')]+_0x1fc5('0x34'));}}if(_0x1fc5('0x2')in _0xcbae19){sessions[_0x1fc5('0x20')](this[_0x1fc5('0xa')]);}}static async[_0x1fc5('0x28')](){const _0x4195cc=await User[_0x1fc5('0x11')]({});const _0x598f8a=game[_0x1fc5('0x22')]['users'];for(let _0x440fea of _0x4195cc){if(!_0x440fea[_0x1fc5('0xa')])continue;const _0x38c678=_0x598f8a[_0x440fea[_0x1fc5('0xa')]]||{};_0x440fea[_0x1fc5('0x1b')]=_0x38c678['active']||![];_0x440fea[_0x1fc5('0x3a')]=_0x38c678['sceneId']||null;}_0x4195cc[_0x1fc5('0x33')]((_0x64d081,_0x5d85cb)=>{let _0x221fbd=_0x64d081[_0x1fc5('0x2f')]>=const_1[_0x1fc5('0x1')][_0x1fc5('0x3f')]?_0x64d081['role']:0x1;let _0x1325e9=_0x5d85cb['role']>=const_1['USER_ROLES'][_0x1fc5('0x3f')]?_0x5d85cb[_0x1fc5('0x2f')]:0x1;if(_0x221fbd!==_0x1325e9)return _0x1325e9-_0x221fbd;return _0x64d081[_0x1fc5('0x17')][_0x1fc5('0x18')](_0x5d85cb['name']);});return game[_0x1fc5('0xe')]=_0x4195cc;}}exports['default']=User;module['exports']=User;const Actor=require(_0x1fc5('0x2a'))['Actor'];
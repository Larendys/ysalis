const _0x5871=['__esModule','find','deleteSubfolders','schema','default','concat','getSubfolders','isFinite','__importDefault','max','type','map','Invalid\x20folder\x20','\x20entities','You\x20cannot\x20assign\x20a\x20Folder\x20to\x20be\x20it\x27s\x20own\x20parent','push','exports','Deleted\x20Folder\x20','../odm/entity','metadata','sort','Folder\x20color\x20must\x20be\x20a\x20valid\x20CSS\x20color\x20string.','includes','isColorString','defineProperty','preSave','findOne','parent','mergeObject','deleteContents','FOLDER_ENTITY_TYPES','permission','deleteMany','updateMany','folder','_id','\x20requested\x20for\x20deletion','../odm/validators','info','SORT_INTEGER_DENSITY','length','color','\x20subfolders,\x20and\x20'];(function(_0x30d293,_0x5871b2){const _0x3779fc=function(_0x1e3270){while(--_0x1e3270){_0x30d293['push'](_0x30d293['shift']());}};_0x3779fc(++_0x5871b2);}(_0x5871,0x131));const _0x3779=function(_0x30d293,_0x5871b2){_0x30d293=_0x30d293-0x0;let _0x3779fc=_0x5871[_0x30d293];return _0x3779fc;};'use strict';var __importDefault=this&&this[_0x3779('0x4')]||function(_0x5795c4){return _0x5795c4&&_0x5795c4[_0x3779('0x27')]?_0x5795c4:{'default':_0x5795c4};};Object[_0x3779('0x14')](exports,_0x3779('0x27'),{'value':!![]});const util=require('../../common/utils');const entity_1=__importDefault(require(_0x3779('0xe')));const const_1=require('../../const');const validators_1=__importDefault(require(_0x3779('0x21')));class Folder extends entity_1['default']{static get[_0x3779('0x2a')](){const _0x5241eb=super[_0x3779('0x2a')];delete _0x5241eb[_0x3779('0x1b')];delete _0x5241eb[_0x3779('0x1e')];_0x5241eb['description']={'type':String,'required':![]};_0x5241eb['parent']={'type':Folder,'required':![]};_0x5241eb['sorting']={'type':String,'required':!![],'default':'a','validate':_0x532aad=>['a','m'][_0x3779('0x12')](_0x532aad),'validationError':'Invalid\x20folder\x20sorting\x20mode\x20requested.'};_0x5241eb[_0x3779('0x10')]={'type':Number,'required':!![]};_0x5241eb[_0x3779('0x25')]={'type':String,'required':![],'validate':validators_1[_0x3779('0x0')][_0x3779('0x13')],'validationError':_0x3779('0x11')};return _0x5241eb;}static get[_0x3779('0xf')](){return util[_0x3779('0x18')](super[_0x3779('0xf')],{'entityTypes':const_1[_0x3779('0x1a')]});}async[_0x3779('0x15')](_0x3f5f0e={}){if(this[_0x3779('0x17')]===this[_0x3779('0x1f')]){throw new Error(_0x3779('0xa'));}if(!Number[_0x3779('0x3')](this['sort'])){const _0x458e2a=await Folder['find']({'type':this[_0x3779('0x6')]});let _0x45255d=Math[_0x3779('0x5')](..._0x458e2a[_0x3779('0x7')](_0x4c7142=>_0x4c7142[_0x3779('0x10')]||0x0));this[_0x3779('0x10')]=_0x45255d+const_1[_0x3779('0x23')];}}static async['_onDelete'](_0x2f1226,_0x257cb6,_0x5c7434){_0x257cb6=_0x257cb6 instanceof Array?_0x257cb6:[_0x257cb6];if(_0x257cb6['length']>0x1){throw new Error('Deleting\x20multiple\x20Folders\x20simultaneously\x20is\x20not\x20currently\x20supported');}const _0x418e96=_0x257cb6[0x0];const _0x31ea87=await this[_0x3779('0x16')]({'_id':_0x418e96});if(!_0x31ea87||!_0x31ea87['type'])throw new Error(_0x3779('0x8')+_0x418e96+_0x3779('0x20'));const _0x581683=db[_0x31ea87[_0x3779('0x6')]];const _0x49da15=_0x31ea87['parent']||null;const _0x988662=await _0x31ea87[_0x3779('0x2')](!![]);const _0x19f9e1=[_0x418e96];const _0x5d4232=[];const _0x360676=_0x5c7434[_0x3779('0x29')]?_0x19f9e1:_0x5d4232;_0x360676[_0x3779('0xb')](..._0x988662[_0x3779('0x7')](_0x1b6b14=>_0x1b6b14[_0x3779('0x1f')]));const _0x29a5f7=await _0x581683['find']({'folder':{'$in':_0x19f9e1}});const _0x33b4d3=[];const _0x4fdb76=[];const _0x1967e1=_0x5c7434[_0x3779('0x19')]?_0x33b4d3:_0x4fdb76;_0x1967e1['push'](..._0x29a5f7[_0x3779('0x7')](_0x51aa5a=>_0x51aa5a[_0x3779('0x1f')]));await this['db'][_0x3779('0x1c')]({'_id':{'$in':_0x19f9e1}});await this['db'][_0x3779('0x1d')]({'_id':{'$in':_0x5d4232}},{'$set':{'parent':_0x49da15}});await _0x581683['db']['deleteMany']({'_id':{'$in':_0x33b4d3}});await _0x581683['db']['updateMany']({'_id':{'$in':_0x4fdb76}},{'$set':{'folder':_0x49da15}});const _0x5d010b=_0x3779('0xd')+_0x418e96+',\x20'+(_0x19f9e1['length']-0x1)+_0x3779('0x26')+_0x33b4d3['length']+'\x20'+_0x581683['name']+_0x3779('0x9');logger[_0x3779('0x22')](_0x5d010b);return{'deleted':_0x418e96,'entityType':_0x581683['type'],'newParent':_0x49da15,'deleteFolderIds':_0x19f9e1,'moveFolderIds':_0x5d4232,'deleteEntityIds':_0x33b4d3,'moveEntityIds':_0x4fdb76};}async[_0x3779('0x2')](_0xd0177e=![]){let _0xa4e695=await Folder[_0x3779('0x28')]({'parent':this[_0x3779('0x1f')]});if(_0xd0177e){let _0x535973=_0xa4e695[_0x3779('0x7')](_0x38d959=>_0x38d959['_id']);while(_0x535973[_0x3779('0x24')]){let _0xf3882b=await Folder[_0x3779('0x28')]({'parent':{'$in':_0x535973}});_0xa4e695=_0xa4e695[_0x3779('0x1')](_0xf3882b);_0x535973=_0xf3882b[_0x3779('0x7')](_0x54d8da=>_0x54d8da[_0x3779('0x1f')]);}}return _0xa4e695;}}exports['default']=Folder;module[_0x3779('0xc')]=Folder;
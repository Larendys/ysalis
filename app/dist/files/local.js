const _0x2b48=['split','\x20saved\x20to\x20','existsSync','\x20does\x20not\x20exist.','test','../const','You\x20may\x20not\x20upload\x20non-media\x20files\x20which\x20would\x20overwrite\x20an\x20existing\x20file\x20on\x20the\x20server.','You\x20may\x20not\x20create\x20directories\x20in\x20this\x20location','filter','basename','map','message','extname','toClientPaths','isSymbolicLink','privateDirs','__importDefault','../common/utils','exports','You\x20may\x20not\x20upload\x20files\x20to\x20this\x20location.','Directory\x20','You\x20may\x20not\x20upload\x20to\x20this\x20location','lstatSync','isDirectory','You\x20may\x20not\x20overwrite\x20an\x20existing\x20file\x20with\x20a\x20MIME\x20type\x20of\x20','configuration','createDirectory','MEDIA_MIME_TYPES','dirs','You\x20are\x20not\x20permitted\x20to\x20create\x20a\x20subdirectory\x20in\x20this\x20location','isAbsolute','join','Unable\x20to\x20place\x20','keys','length','statSync','\x20in\x20','posix','root','posixPath','reduce','name','default','push','dirname','lookup','data','minimatch','from','readdirSync','upload','__esModule','localeCompare','relative','sort','mime-types','isAdmin','private','getFiles','gridSize','User\x20Data\x20storage','Target\x20directory\x20','files','startsWith','includes','getDirectories','toClientPath','defineProperty'];(function(_0x493683,_0x2b48df){const _0xc1cf93=function(_0xc31492){while(--_0xc31492){_0x493683['push'](_0x493683['shift']());}};_0xc1cf93(++_0x2b48df);}(_0x2b48,0x197));const _0xc1cf=function(_0x493683,_0x2b48df){_0x493683=_0x493683-0x0;let _0xc1cf93=_0x2b48[_0x493683];return _0xc1cf93;};'use strict';var __importDefault=this&&this[_0xc1cf('0x11')]||function(_0x1707f6){return _0x1707f6&&_0x1707f6[_0xc1cf('0x34')]?_0x1707f6:{'default':_0x1707f6};};Object[_0xc1cf('0x0')](exports,_0xc1cf('0x34'),{'value':!![]});const {encodeURL}=require(_0xc1cf('0x12'));const mime=require(_0xc1cf('0x38'));const fs_1=__importDefault(require('fs'));const minimatch_1=__importDefault(require(_0xc1cf('0x30')));const path_1=__importDefault(require('path'));const storage_1=__importDefault(require('./storage'));const const_1=require(_0xc1cf('0x6'));class LocalFileStorage extends storage_1[_0xc1cf('0x2b')]{constructor(_0x314d1b,_0xaca5e7){super(_0x314d1b);this[_0xc1cf('0x27')]=_0xaca5e7;}async[_0xc1cf('0x1b')](_0x5b673c,_0x54d16d={}){if(this[_0xc1cf('0x27')]!==paths[_0xc1cf('0x2f')]||!_0x54d16d[_0xc1cf('0x39')]){throw new Error(_0xc1cf('0x8'));}const _0x2d95e0=path_1['default'][_0xc1cf('0x20')](this[_0xc1cf('0x27')],_0x5b673c);const _0x1832a6=path_1[_0xc1cf('0x2b')][_0xc1cf('0x36')](this[_0xc1cf('0x27')],_0x2d95e0);const _0x2f1b03=_0x1832a6&&(_0x1832a6[_0xc1cf('0x40')]('..')||path_1['default'][_0xc1cf('0x1f')](_0x1832a6));if(_0x2f1b03){throw new Error(_0xc1cf('0x1e'));}fs_1[_0xc1cf('0x2b')]['mkdirSync'](decodeURIComponent(_0x2d95e0));return _0x2d95e0;}[_0xc1cf('0x42')](_0x504d66){return fs_1[_0xc1cf('0x2b')]['readdirSync'](_0x504d66)[_0xc1cf('0xb')](_0x19f59e=>path_1[_0xc1cf('0x2b')][_0xc1cf('0x20')](_0x504d66,_0x19f59e))[_0xc1cf('0x9')](this[_0xc1cf('0x18')]);}async[_0xc1cf('0x3b')]({target='.',extensions=[],wildcard=![],isAdmin=![]}={}){const _0x1f1a85=target;target=decodeURIComponent(target);let _0x20e05a=path_1[_0xc1cf('0x2b')][_0xc1cf('0x20')](this[_0xc1cf('0x27')],target);const _0x5cc78b=Array[_0xc1cf('0x31')](extensions);const _0x12d1ab=path_1[_0xc1cf('0x2b')][_0xc1cf('0x36')](this[_0xc1cf('0x27')],_0x20e05a);const _0x1c7b69=_0x12d1ab&&(_0x12d1ab[_0xc1cf('0x40')]('..')||path_1[_0xc1cf('0x2b')][_0xc1cf('0x1f')](_0x12d1ab));if(_0x1c7b69){_0x20e05a=this[_0xc1cf('0x27')];target='';}let _0x3deaba='';if(!this[_0xc1cf('0x18')](_0x20e05a)){_0x3deaba=path_1[_0xc1cf('0x2b')][_0xc1cf('0xa')](target);target=path_1['default'][_0xc1cf('0x2d')](target);_0x20e05a=path_1['default'][_0xc1cf('0x2d')](_0x20e05a);}if(!fs_1['default'][_0xc1cf('0x3')](_0x20e05a))throw new Error(_0xc1cf('0x15')+target+'\x20does\x20not\x20exist');const _0x26b0fa=Object[_0xc1cf('0x22')](this['configuration']);_0x26b0fa[_0xc1cf('0x37')]((_0x1ff8f2,_0x2f1d6c)=>{const _0x6350dc=_0x2f1d6c['split']('/')[_0xc1cf('0x23')]-_0x1ff8f2[_0xc1cf('0x1')]('/')[_0xc1cf('0x23')];if(_0x6350dc!==0x0)return _0x6350dc;if(_0x1ff8f2==='')return 0x1;if(_0x2f1d6c==='')return-0x1;return _0x1ff8f2[_0xc1cf('0x35')](_0x2f1d6c);});let _0x2e45d0=_0x26b0fa['find'](_0x31953f=>RegExp(_0x31953f)[_0xc1cf('0x5')](_0x1f1a85))||'';const _0x3dc56a=this[_0xc1cf('0x1a')][_0x2e45d0]||{'private':![],'gridSize':null};const _0x4fcf83={'target':encodeURL(target),'private':_0x3dc56a[_0xc1cf('0x3a')],'gridSize':_0x3dc56a[_0xc1cf('0x3c')],'dirs':[],'privateDirs':[],'files':[],'extensions':extensions};if(_0x3dc56a[_0xc1cf('0x3a')]&&!isAdmin)return _0x4fcf83;const _0x29a81d=fs_1[_0xc1cf('0x2b')][_0xc1cf('0x32')](_0x20e05a)[_0xc1cf('0xb')](_0x3d0846=>path_1[_0xc1cf('0x2b')][_0xc1cf('0x20')](_0x20e05a,_0x3d0846));const _0x2c4c23=_0x29a81d[_0xc1cf('0x29')]((_0x42857f,_0x232751)=>{let _0x1aee29=path_1[_0xc1cf('0x2b')][_0xc1cf('0xa')](_0x232751);if(_0x1aee29[_0xc1cf('0x40')]('.'))return _0x42857f;if(wildcard&&!minimatch_1[_0xc1cf('0x2b')](_0x1aee29,_0x3deaba))return _0x42857f;if(this[_0xc1cf('0x18')](_0x232751)){let _0x2a9ffb=encodeURI(path_1[_0xc1cf('0x2b')][_0xc1cf('0x26')][_0xc1cf('0x20')](target,_0x1aee29));const _0x445099=_0x2a9ffb in this[_0xc1cf('0x1a')]&&this[_0xc1cf('0x1a')][_0x2a9ffb]['private'];if(_0x445099){if(!isAdmin)return _0x42857f;_0x42857f[_0xc1cf('0x10')][_0xc1cf('0x2c')](_0x2a9ffb);}_0x42857f['dirs'][_0xc1cf('0x2c')](_0x232751);return _0x42857f;}const _0x292d1f=path_1['default'][_0xc1cf('0xd')](_0x1aee29);if(_0x5cc78b[_0xc1cf('0x23')]&&_0x5cc78b[_0xc1cf('0x41')](_0x292d1f)||!_0x5cc78b[_0xc1cf('0x23')]&&_0x292d1f!==''){_0x42857f[_0xc1cf('0x3f')]['push'](_0x232751);}return _0x42857f;},_0x4fcf83);_0x2c4c23[_0xc1cf('0x1d')]=this[_0xc1cf('0xe')](_0x2c4c23[_0xc1cf('0x1d')],this[_0xc1cf('0x27')]);_0x2c4c23[_0xc1cf('0x3f')]=this['toClientPaths'](_0x2c4c23['files'],this[_0xc1cf('0x27')]);return _0x2c4c23;}[_0xc1cf('0x18')](_0x26c1c0){let _0x3624a2=null;try{_0x3624a2=fs_1['default'][_0xc1cf('0x17')](_0x26c1c0);}catch(_0x4c1ef4){return![];}if(_0x3624a2[_0xc1cf('0x18')]())return!![];if(_0x3624a2[_0xc1cf('0xf')]()){try{const _0x4ef414=fs_1['default'][_0xc1cf('0x24')](_0x26c1c0);return _0x4ef414[_0xc1cf('0x18')]();}catch(_0xfd25f4){return![];}}return![];}async[_0xc1cf('0x33')](_0x2cde1d,{target,overwrite=![]}={}){if(this[_0xc1cf('0x27')]!==paths[_0xc1cf('0x2f')])throw new Error(_0xc1cf('0x16'));const _0xb22b52=path_1[_0xc1cf('0x2b')][_0xc1cf('0x20')](this[_0xc1cf('0x27')],target);if(!fs_1[_0xc1cf('0x2b')]['existsSync'](_0xb22b52))throw new Error(_0xc1cf('0x3e')+_0xb22b52+_0xc1cf('0x4'));const _0x5768f0=path_1['default'][_0xc1cf('0x36')](this[_0xc1cf('0x27')],_0xb22b52);const _0x556067=_0x5768f0&&(_0x5768f0[_0xc1cf('0x40')]('..')||path_1[_0xc1cf('0x2b')][_0xc1cf('0x1f')](_0x5768f0));if(_0x556067)throw new Error(_0xc1cf('0x14'));const _0x26d49e=path_1['default'][_0xc1cf('0x20')](_0xb22b52,_0x2cde1d['name']);const _0x798068=this[_0xc1cf('0x43')](_0x26d49e,this[_0xc1cf('0x27')]);if(fs_1[_0xc1cf('0x2b')][_0xc1cf('0x3')](_0x26d49e)){if(!overwrite){throw new Error(_0xc1cf('0x7'));}const _0x4c8052=mime[_0xc1cf('0x2e')](_0x26d49e);if(!const_1[_0xc1cf('0x1c')][_0xc1cf('0x41')](_0x4c8052)){throw new Error(_0xc1cf('0x19')+_0x4c8052+'.');}}return new Promise(_0xdae122=>{_0x2cde1d['mv'](_0x26d49e,function(_0x3403df){const _0x8aba99=target!==''?target:_0xc1cf('0x3d');if(_0x3403df){_0x3403df[_0xc1cf('0xc')]=_0xc1cf('0x21')+_0x2cde1d[_0xc1cf('0x2a')]+_0xc1cf('0x25')+_0x8aba99;throw _0x3403df;}const _0x47d87b=_0x2cde1d['name']+_0xc1cf('0x2')+_0x8aba99;logger['info'](_0x47d87b);_0xdae122({'status':'success','message':_0x47d87b,'path':_0x798068});});});}[_0xc1cf('0x43')](_0x4ba886,_0x193ac2){return LocalFileStorage['toClientPath'](_0x4ba886,_0x193ac2);}static['toClientPath'](_0x4f5481,_0x2c3d7f){return encodeURL(this[_0xc1cf('0x28')](path_1['default'][_0xc1cf('0x36')](_0x2c3d7f,_0x4f5481)));}}exports['default']=LocalFileStorage;module[_0xc1cf('0x13')]=LocalFileStorage;